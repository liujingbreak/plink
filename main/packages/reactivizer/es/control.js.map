{"version":3,"file":"control.js","sourceRoot":"","sources":["../src/control.ts"],"names":[],"mappings":"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","sourcesContent":["import * as rx from 'rxjs';\nimport {Action, ActionFunctions, InferMapParam, InferPayload, ActionMeta,\n  ArrayOrTuple, ControllerCore, Dispatch, DispatchFor, PayloadStream, CoreOptions,\n  has, nameOfAction, actionMetaToStr\n} from './stream-core';\n\nexport * from './stream-core';\n\ntype DispatchAndObserveRes<I extends ActionFunctions, K extends keyof I> = <O extends ActionFunctions, R extends keyof O>(\n  waitForAction$: rx.Observable<Action<O, R>>, ...params: InferPayload<I[K]>\n) => rx.Observable<InferMapParam<O, R>>;\n\ntype DispatchForAndObserveRes<I extends ActionFunctions, K extends keyof I> = <O extends ActionFunctions, R extends keyof O>(\n  waitForAction$: rx.Observable<Action<O, R>>, origActionMeta: ActionMeta | ArrayOrTuple<ActionMeta> | null, ...params: InferPayload<I[K]>\n) => rx.Observable<InferMapParam<O, R>>;\n\nexport class RxController<I extends ActionFunctions> {\n  core: ControllerCore<I>;\n  dispatcher: {[K in keyof I]: Dispatch<I[K]>};\n  dispatcherFor: {[K in keyof I]: DispatchFor<I[K]>};\n  /** abbrevation of property \"dispatcher\", exactly same instance of dispatcher */\n  dp: {[K in keyof I]: Dispatch<I[K]>};\n  /** abbrevation of property \"dispatcherFor\", exactly same instance of dispatcherFor */\n  dpf: {[K in keyof I]: DispatchFor<I[K]>};\n  dispatchAndObserveRes: {[K in keyof I]: DispatchAndObserveRes<I, K>};\n  /** abbrevation of property \"dispatchAndObserveRes\", exactly same instance of dispatchAndObserveRes */\n  do: {[K in keyof I]: DispatchAndObserveRes<I, K>};\n  dispatchForAndObserveRes: {[K in keyof I]: DispatchForAndObserveRes<I, K>};\n  /** abbrevation of dispatchForAndObserveRes */\n  dfo: {[K in keyof I]: DispatchForAndObserveRes<I, K>};\n  payloadByType: {[K in keyof I]: PayloadStream<I, K>};\n  /** abbrevation of payloadByType */\n  pt: {[K in keyof I]: PayloadStream<I, K>};\n  actionByType: {[K in keyof I]: rx.Observable<Action<I, K>>};\n  /** abbrevation of actionByType */\n  at: {[K in keyof I]: rx.Observable<Action<I, K>>};\n\n  updateInterceptor: ControllerCore<I>['updateInterceptor'];\n\n  constructor(public opts?: CoreOptions<(string & keyof I)[]>) {\n    const core = this.core = new ControllerCore(opts);\n\n    this.dispatcher = this.dp = new Proxy({} as {[K in keyof I]: Dispatch<I[K]>}, {\n      get(_target, key, _rec) {\n        return core.dispatchFactory(key as keyof I);\n      }\n    });\n    this.dispatcherFor = this.dpf = new Proxy({} as {[K in keyof I]: DispatchFor<I[K]>}, {\n      get(_target, key, _rec) {\n        return core.dispatchForFactory(key as keyof I);\n      }\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const self = this;\n    this.dispatchForAndObserveRes = this.dfo = new Proxy({} as {[K in keyof I]: DispatchForAndObserveRes<I, K>}, {\n      get(_target, key, _rec) {\n\n        return <R extends keyof I>(action$: rx.Observable<Action<I, R>>, referActions: ActionMeta | ArrayOrTuple<ActionMeta> | null, ...params: any[]) => {\n          const action = self.core.createAction(key as string, params as InferPayload<I[string]>);\n          if (referActions)\n            action.r = Array.isArray(referActions) ? referActions.map(m => m.i) : (referActions as ActionMeta).i;\n          const r$ = new rx.ReplaySubject<InferMapParam<I, R>>(1);\n          rx.merge(\n            action$.pipe(\n              actionRelatedToAction(action.i),\n              mapActionToPayload()\n            ),\n            new rx.Observable<never>(sub => {\n              self.core.actionUpstream.next(action);\n              sub.complete();\n            })\n          ).subscribe(r$);\n          return r$.asObservable();\n        };\n      }\n    });\n\n    this.dispatchAndObserveRes = this.do = new Proxy({} as {[K in keyof I]: DispatchAndObserveRes<I, K>}, {\n      get(_target, key, _rec) {\n\n        return <R extends keyof I>(action$: rx.Observable<Action<I, R>>, ...params: any[]) => {\n          return self.dfo[key as keyof I](action$, null, ...(params as any));\n        };\n      }\n    });\n\n    const actionsByType = {} as {[K in keyof I]: rx.Observable<Action<I, K>>};\n    const actionByTypeProxy = new Proxy(\n      {} as typeof actionsByType,\n      {\n        get(_target, type, _rec) {\n          let a$ = actionsByType[type as keyof I];\n          if (a$ == null) {\n            const matchType = core.typePrefix + (type as string);\n            a$ = actionsByType[type as keyof I] = core.action$.pipe(\n              rx.filter(({t}) => t === matchType),\n              rx.share()\n            );\n          }\n          return a$;\n        }\n      });\n\n    const payloadsByType = {} as {[K in keyof I]: rx.Observable<InferMapParam<I, K>>};\n    this.actionByType = this.at = actionByTypeProxy;\n\n    this.payloadByType = this.pt = new Proxy(\n      {} as typeof payloadsByType,\n      {\n        get(_target, key, _rec) {\n          let p$ = payloadsByType[key as keyof I];\n          if (p$ == null) {\n            const a$ = actionByTypeProxy[key as keyof I];\n            p$ = payloadsByType[key as keyof I] = a$.pipe(\n              mapActionToPayload(),\n              rx.share()\n            );\n          }\n          return p$;\n        }\n      });\n    this.updateInterceptor = core.updateInterceptor;\n  }\n\n  createAction<J extends ActionFunctions = I, K extends keyof J = keyof J>(type: K, ...params: InferPayload<J[K]>) {\n    return this.core.createAction(type, params);\n  }\n\n  /** This method internally uses [groupBy](https://rxjs.dev/api/index/function/groupBy#groupby) */\n  groupControllerBy<K>(keySelector: (action: Action<I>) => K, groupedCtlOptionsFn?: (key: K) => CoreOptions<(string & keyof I)[]>):\n  rx.Observable<[newGroup: GroupedRxController<I, K>, allGroups: Map<K, GroupedRxController<I, K>>]> {\n    return this.core.action$.pipe(\n      rx.groupBy(keySelector),\n      rx.map(grouped => {\n        const groupedRxCtl = new GroupedRxController<I, K>(grouped.key, {...(groupedCtlOptionsFn ? groupedCtlOptionsFn(grouped.key) : {}), autoConnect: false});\n\n        // connect to source actionUpstream only when it is subscribed\n        rx.concat(\n          groupedRxCtl.core.actionSubscribed$.pipe(\n            rx.tap(() => {\n              groupedRxCtl.connect();\n            }),\n            rx.take(1)\n          ),\n          // Then dispatch source action to grouped controller\n          grouped.pipe(\n            rx.tap(action => deserializeAction(action, groupedRxCtl))\n          )\n        ).pipe(\n          rx.takeUntil(groupedRxCtl.core.actionUnsubscribed$)\n        ).subscribe();\n\n        return groupedRxCtl;\n      }),\n      rx.scan<\n      GroupedRxController<I, K>,\n      [newGroup: GroupedRxController<I, K>, allGroups: Map<K, GroupedRxController<I, K>>],\n      readonly [null, Map<K, GroupedRxController<I, K>>]\n      >((acc, el) => {\n        const ret = acc as unknown as [GroupedRxController<I, K>, Map<K, GroupedRxController<I, K>>];\n        ret[0] = el;\n        ret[1].set(el.key, el);\n        return ret;\n      }, [null, new Map<K, GroupedRxController<I, K>>()] as const)\n    );\n  }\n\n  /**\n   * Delegate to `this.core.action$.connect()`\n   * \"core.action$\" is a `connectable` observable, under the hook, it is like `action$ = connectable(actionUpstream)`.\n   *\n   * By default `connect()` will be immediately invoked in constructor function, when \"options.autoConnect\" is\n   * `undefined` or `true`, in that case you don't need to call this method manually.\n   *\n   * Refer to [connectable](https://rxjs.dev/api/index/function/connectable)\n   */\n  connect() {\n    this.core.connect();\n  }\n}\n\nexport class GroupedRxController<I extends ActionFunctions, K> extends RxController<I> {\n  constructor(public key: K, opts?: CoreOptions<(string & keyof I)[]>) {\n    super(opts);\n  }\n}\n\n/**\n * If we consider ActionTable a 2-dimentional data structure, this is the infer type of it.\n * Each row is latest action payload of an action type (or name),\n * each column is a element of payload content array.\n *\n * If you use ActionTable as a frontend UI state (like for a UI template), this infer type\n * defines exactly data structure of it.\n * \n */\nexport type ActionTableDataType<I extends ActionFunctions, KS extends ReadonlyArray<keyof I>> = {\n  [P in KS[number]]: InferPayload<I[P]>\n};\n\nexport class ActionTable<I extends ActionFunctions, KS extends ReadonlyArray<keyof I>> {\n  actionNames: KS;\n\n  latestPayloads = {} as {[K in KS[number]]: PayloadStream<I, K>};\n  /** Abbrevation of \"latestPayloads\", pointing to exactly same instance of latestPayloads */\n  l: {[K in KS[number]]: PayloadStream<I, K>};\n\n  get dataChange$(): rx.Observable<ActionTableDataType<I, KS>> {\n    if (this.#latestPayloadsByName$)\n      return this.#latestPayloadsByName$;\n\n    this.#latestPayloadsByName$ = this.actionNamesAdded$.pipe(\n      rx.switchMap(() => rx.merge(...this.actionNames.map(actionName => this.l[actionName]))),\n      rx.map(() => {\n        const payloadByName = {} as {[P in KS[number]]: InferPayload<I[P]>};\n        for (const [k, [, ...v]] of this.actionSnapshot.entries()) {\n          payloadByName[k] = v;\n        }\n        return payloadByName;\n      }),\n      rx.share()\n    );\n    return this.#latestPayloadsByName$;\n  }\n\n  get latestPayloadsSnapshot$(): rx.Observable<Map<keyof I, InferMapParam<I, keyof I>>> {\n    if (this.#latestPayloadsSnapshot$)\n      return this.#latestPayloadsSnapshot$;\n\n    this.#latestPayloadsSnapshot$ = this.actionNamesAdded$.pipe(\n      rx.switchMap(() => rx.merge(...this.actionNames.map(actionName => this.l[actionName]))),\n      rx.map(() => this.actionSnapshot)\n    );\n    return this.#latestPayloadsSnapshot$;\n  }\n\n  actionSnapshot = new Map<keyof I, InferMapParam<I, keyof I>>();\n\n  // private\n  #latestPayloadsByName$: rx.Observable<{[P in KS[number]]: InferPayload<I[P]>}> | undefined;\n  #latestPayloadsSnapshot$: rx.Observable<Map<keyof I, InferMapParam<I, keyof I>>> | undefined;\n  private actionNamesAdded$ = new rx.ReplaySubject<ReadonlyArray<keyof I>>(1);\n\n  constructor(private streamCtl: RxController<I>, actionNames: KS) {\n    this.actionNames = [] as unknown as KS;\n    this.l = this.latestPayloads;\n    this.addActions(...actionNames);\n    this.actionNamesAdded$.pipe(\n      rx.map(actionNames => {\n        this.onAddActions(actionNames);\n      })\n    ).subscribe();\n\n  }\n\n  addActions<M extends Array<keyof I>>(...actionNames: M) {\n    this.actionNames = this.actionNames.concat(actionNames) as unknown as KS;\n    this.actionNamesAdded$.next(actionNames);\n    return this as unknown as ActionTable<I, Array<KS[number] | M[number]>>;\n  }\n\n  private onAddActions<M extends ReadonlyArray<keyof I>>(actionNames: M) {\n    for (const type of actionNames) {\n      if (has.call(this.latestPayloads, type))\n        continue;\n\n      const a$ = new rx.ReplaySubject<InferMapParam<I, M[number]>>(1);\n      this.streamCtl.actionByType[type].pipe(\n        rx.map(a => {\n          const mapParam = [{i: a.i, r: a.r}, ...a.p] as InferMapParam<I, M[number]>;\n          this.actionSnapshot.set(type, mapParam);\n          return mapParam;\n        })\n      ).subscribe(a$);\n\n      this.latestPayloads[type] = this.streamCtl.opts?.debug ?\n        a$.pipe(\n          this.debugLogLatestActionOperator(type as string)\n        ) :\n        a$.asObservable();\n    }\n  }\n\n  getLatestActionOf<K extends KS[number]>(actionName: K): InferMapParam<I, K> | undefined {\n    return this.actionSnapshot.get(actionName) as InferMapParam<I, K> | undefined;\n  }\n\n  protected debugLogLatestActionOperator<K extends string & keyof I, P extends InferMapParam<I, K>>(type: K) {\n    const core = this.streamCtl.core;\n    return this.streamCtl.opts?.log ?\n      rx.map<P, P>((action, idx) => {\n        if (idx === 0 && !core.debugExcludeSet.has(type)) {\n          this.streamCtl.opts!.log!(core.logPrefix + 'rx:latest', type, action);\n        }\n        return action;\n      }) :\n      (typeof window !== 'undefined') || (typeof Worker !== 'undefined') ?\n        rx.map<P, P>((p, idx) => {\n          if (idx === 0 && !core.debugExcludeSet.has(type)) {\n            // eslint-disable-next-line no-console\n            console.log(`%c ${core.logPrefix}rx:latest `, 'color: #f0fe0fe0; background: #8c61dd;', type,\n              actionMetaToStr(p[0]));\n          }\n          return p;\n        }) :\n        rx.map<P, P>((p, idx) => {\n          if (idx > 0 && !core.debugExcludeSet.has(type)) {\n            // eslint-disable-next-line no-console\n            console.log(core.logPrefix + 'latest:', type, actionMetaToStr(p[0]));\n          }\n          return p;\n        });\n  }\n}\n\n/** Rx operator function */\nexport function actionRelatedToAction<T extends Action<any>>(id: ActionMeta['i']) {\n  return function(up: rx.Observable<T>) {\n    return up.pipe(\n      rx.filter(\n        m => (m.r != null && m.r === id) || (\n          Array.isArray(m.r) && m.r.some(r => r === id)\n        )\n      )\n    );\n  };\n}\n/** Rx operator function */\nexport function actionRelatedToPayload<T extends [ActionMeta, ...any[]]>(id: ActionMeta['i']) {\n  return function(up: rx.Observable<T>): rx.Observable<T> {\n    return up.pipe(\n      rx.filter(\n        ([m]) => (m.r != null && m.r === id) || (\n          Array.isArray(m.r) && m.r.some(r => r === id)\n        )\n      )\n    );\n  };\n}\n\nexport function serializeAction<I extends ActionFunctions = any, K extends keyof I = string>(action: Action<I, K>) {\n  const a = {...action, t: nameOfAction(action)};\n  // if (a.r instanceof Set) {\n  //   a.r = [...a.r.values()];\n  // }\n  return a;\n}\n\n/**\n * Create a new Action with same \"p\", \"i\" and \"r\" properties and dispatched to RxController,\n * but changed \"t\" property which comfort to target \"toRxController\"\n * @return that dispatched new action object\n */\nexport function deserializeAction<I extends ActionFunctions>(actionObj: any, toController: RxController<I>) {\n  const newAction = toController.core.createAction(nameOfAction(actionObj) as keyof I, (actionObj as Action<I>).p);\n  newAction.i = (actionObj as Action<any>).i;\n  if ((actionObj as Action<any>).r)\n    newAction.r = (actionObj as Action<any>).r;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  toController.core.actionUpstream.next(newAction);\n  return newAction;\n}\n\nfunction mapActionToPayload<I extends ActionFunctions, K extends keyof I>() {\n  return (up: rx.Observable<Action<I, K>>) => up.pipe(\n    rx.map(a => [{i: a.i, r: a.r}, ...a.p] as InferMapParam<I, keyof I>)\n  );\n}\n"]}
{"version":3,"file":"lazy-package-factory.js","sourceRoot":"","sources":["../../ts/package-mgr/lazy-package-factory.ts"],"names":[],"mappings":";;;;AAEA,6DAAuD;AACvD,yFAAqD;AAErD,wCAAuC;AACvC,+BAA6B;AAC7B;;GAEG;AACH,MAAqB,kBAAkB;IAGrC,YAAoB,gBAAuC;QAAvC,qBAAgB,GAAhB,gBAAgB,CAAuB;IAC3D,CAAC;IAED,gBAAgB,CAAC,IAAY;QAC3B,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,EAAE;YAC/B,IAAI,CAAC,cAAc,GAAG,IAAI,kBAAO,EAAmB,CAAC;YACrD,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,gBAAgB,EAAE;gBACxC,MAAM,EAAE,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC;gBAC/B,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;gBAC/C,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAA,cAAO,EAAC,eAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;aACvE;SACF;QACD,IAAI,KAAwB,CAAC;QAC7B,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC;YAClB,OAAO,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACjC,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AArBD,qCAqBC;AAED,SAAgB,SAAS,CAAC,QAAgB;IAExC,MAAM,KAAK,GAAG,uBAAuB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACrD,IAAI,KAAK,EAAE;QACT,OAAO;YACL,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;YACf,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;SACf,CAAC;KACH;IACD,OAAO,EAAC,IAAI,EAAE,QAAQ,EAAC,CAAC;AAC1B,CAAC;AAVD,8BAUC;AAED,SAAS,aAAa,CAAC,IAAiB;IACtC,MAAM,QAAQ,GAAG,IAAI,6BAAe,CAAC;QACnC,QAAQ,EAAE,IAAI,CAAC,IAAI;QACnB,SAAS,EAAE,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI;QACpC,IAAI,EAAE,IAAA,cAAO,EAAC,eAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC;QAC1C,QAAQ,EAAE,IAAI,CAAC,QAAQ;QACvB,IAAI,EAAE,IAAI,CAAC,IAAI;KAChB,CAAC,CAAC;IACH,0CAA0C;IAC1C,sBAAsB;IACtB,gCAAgC;IAChC,8EAA8E;IAC9E,MAAM;IACN,0CAA0C;IAC1C,wFAAwF;IACxF,MAAM;IACN,IAAI;IAEJ,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,2CAA2C;AAC3C,+BAA+B;AAC/B,8BAA8B;AAC9B,0BAA0B;AAC1B,MAAM;AACN,cAAc;AACd,IAAI","sourcesContent":["// import * as Path from 'path';\nimport * as _ from 'lodash';\nimport {DirTree} from 'require-injector/dist/dir-tree';\nimport PackageInstance from '../packageNodeInstance';\nimport {PackageInfo} from '.';\nimport {plinkEnv} from '../utils/misc';\nimport {resolve} from 'path';\n/**\n * @deprecated\n */\nexport default class LazyPackageFactory {\n  packagePathMap: DirTree<PackageInstance> | undefined;\n\n  constructor(private packagesIterable: Iterable<PackageInfo>) {\n  }\n\n  getPackageByPath(file: string): PackageInstance | null {\n    if (this.packagePathMap == null) {\n      this.packagePathMap = new DirTree<PackageInstance>();\n      for (const info of this.packagesIterable) {\n        const pk = createPackage(info);\n        this.packagePathMap.putData(info.realPath, pk);\n        this.packagePathMap.putData(resolve(plinkEnv.workDir, info.path), pk);\n      }\n    }\n    let found: PackageInstance[];\n    found = this.packagePathMap.getAllData(file);\n    if (found.length > 0)\n      return found[found.length - 1];\n    return null;\n  }\n}\n\nexport function parseName(longName: string): {name: string; scope?: string} {\n\n  const match = /^(?:@([^/]+)\\/)?(\\S+)/.exec(longName);\n  if (match) {\n    return {\n      scope: match[1],\n      name: match[2]\n    };\n  }\n  return {name: longName};\n}\n\nfunction createPackage(info: PackageInfo) {\n  const instance = new PackageInstance({\n    longName: info.name,\n    shortName: parseName(info.name).name,\n    path: resolve(plinkEnv.workDir, info.path),\n    realPath: info.realPath,\n    json: info.json\n  });\n  // let noParseFiles: string[] | undefined;\n  // if (info.json.dr) {\n  //   if (info.json.dr.noParse) {\n  //     noParseFiles = [].concat(info.json.dr.noParse).map(trimNoParseSetting);\n  //   }\n  //   if (info.json.dr.browserifyNoParse) {\n  //     noParseFiles = [].concat(info.json.dr.browserifyNoParse).map(trimNoParseSetting);\n  //   }\n  // }\n\n  return instance;\n}\n\n// function trimNoParseSetting(p: string) {\n//   p = p.replace(/\\\\/g, '/');\n//   if (p.startsWith('./')) {\n//     p = p.substring(2);\n//   }\n//   return p;\n// }\n"]}
{"version":3,"file":"cli-analyze.js","sourceRoot":"","sources":["../../ts/cmd/cli-analyze.ts"],"names":[],"mappings":"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","sourcesContent":["import os from 'os';\nimport Path from 'path';\nimport glob from 'glob';\nimport _ from 'lodash';\n// import { PayloadAction } from '@reduxjs/toolkit';\nimport { ignoreElements, catchError, map, mergeMap} from 'rxjs/operators';\nimport * as op from 'rxjs/operators';\nimport {merge} from 'rxjs';\nimport log4js from 'log4js';\nimport chalk from 'chalk';\nimport {Pool} from '../../../packages/thread-promise-pool/dist';\nimport {createCliTable} from '../utils/misc';\nimport { stateFactory, ofPayloadAction, createReducers } from '../store';\nimport {getState} from '../package-mgr';\nimport {getTscConfigOfPkg} from '../utils/misc';\nimport {findPackagesByNames} from './utils';\nimport {Context} from './cli-analyse-worker';\nimport {AnalyzeOptions} from './types';\n// import config from '../config';\n\nconst log = log4js.getLogger('plink.analyse');\nconst cpus = os.cpus().length;\n\nexport default function(packages: string[], opts: AnalyzeOptions) {\n  const alias: [reg: string, replace: string][] =\n    opts.alias.map(item => {\n      if (!item.startsWith('['))\n        item = '[' + item;\n      if (!item.endsWith(']'))\n        item = item + ']';\n      try {\n        return JSON.parse(item) as [reg: string, replace: string];\n      } catch (e) {\n        log.error('Can not parse JSON: ' + item);\n        throw e;\n      }\n    });\n\n  if (opts.file && opts.file.length > 0) {\n    dispatcher.analyzeFile({\n      files: opts.file,\n      alias,\n      tsconfig: opts.tsconfig,\n      ignore: opts.x\n    });\n  } else if (opts.dir && opts.dir.length > 0) {\n    dispatcher.analyzeFile({\n      files: opts.dir.map(dir => dir.replace(/\\\\/g, '/') + '/**/*'),\n      alias,\n      tsconfig: opts.tsconfig,\n      ignore: opts.x\n    });\n  } else {\n    // log.warn('Sorry, not implemented yet, use with argument \"-f\" for now.');\n    let i = 0;\n    for (const pkg of findPackagesByNames(getState(), packages)) {\n      if (pkg == null) {\n        log.error(`Can not find package for name \"${packages[i]}\"`);\n        continue;\n      }\n      const dirs = getTscConfigOfPkg(pkg.json);\n      const patterns = [`${pkg.realPath.replace(/\\\\/g, '/')}/${dirs.srcDir}/**/*`];\n      if (dirs.isomDir) {\n        patterns.push(`${pkg.realPath.replace(/\\\\/g, '/')}/${dirs.srcDir}/**/*.ts`);\n      }\n      dispatcher.analyzeFile({files: patterns, alias, ignore: opts.x});\n      i++;\n    }\n  }\n  getStore().pipe(\n    map(s => s.result), op.distinctUntilChanged(),\n    op.skip(1),\n    op.tap((result) => {\n      printResult(result!, opts);\n    }),\n    op.take(1)\n  ).subscribe();\n\n}\n\nexport function printResult(result: NonNullable<AnalyzeState['result']>, opts: {j: AnalyzeOptions['j']}) {\n  if (result.canNotResolve.length > 0) {\n    const table = createCliTable({horizontalLines: false});\n    table.push([{colSpan: 2, content: chalk.bold('Can not resolve dependecies'), hAlign: 'center'}]);\n    table.push([{hAlign: 'right', content: '--'}, '--------']);\n    let i = 1;\n    for (const msg of result.canNotResolve) {\n      // eslint-disable-next-line no-console\n      table.push([{hAlign: 'right', content: i++}, JSON.stringify(msg, null, '  ')]);\n    }\n    // eslint-disable-next-line no-console\n    console.log(table.toString());\n  }\n\n  if (result.cyclic.length > 0) {\n    let i = 1;\n    const table = createCliTable({horizontalLines: false});\n    table.push([{colSpan: 2, content: chalk.bold('Cyclic dependecies'), hAlign: 'center'}]);\n    table.push([{hAlign: 'right', content: '--'}, '--------']);\n    for (const msg of result.cyclic) {\n      table.push([{hAlign: 'right', content: i++}, msg]);\n    }\n    // eslint-disable-next-line no-console\n    console.log(table.toString());\n  }\n\n  if (result.externalDeps.length > 0) {\n    let i = 1;\n    const table = createCliTable({horizontalLines: false});\n    table.push([{colSpan: 2, content: chalk.bold('External dependecies'), hAlign: 'center'}]);\n    if (!opts.j) {\n      table.push([{hAlign: 'right', content: '--'}, '--------']);\n      for (const msg of result.externalDeps) {\n        table.push([{hAlign: 'right', content: i++}, msg]);\n      }\n      for (const msg of result.nodeModuleDeps) {\n        table.push([{hAlign: 'right', content: i++}, msg + ' (Node.js)']);\n      }\n    }\n    // eslint-disable-next-line no-console\n    console.log(table.toString());\n    if (opts.j) {\n      // eslint-disable-next-line no-console\n      console.log(JSON.stringify(result.externalDeps, null, '  '));\n    }\n  }\n\n  if (result.relativeDepsOutSideDir.length > 0) {\n    let i = 1;\n    const table = createCliTable({horizontalLines: false});\n    table.push([{\n      colSpan: 2,\n      content: chalk.bold(`Dependencies outside of ${result.commonDir}`),\n      hAlign: 'center'\n    }]);\n    table.push([{hAlign: 'right', content: '--'}, '--------']);\n    for (const msg of result.relativeDepsOutSideDir) {\n      table.push([{hAlign: 'right', content: i++}, msg]);\n    }\n    // eslint-disable-next-line no-console\n    console.log(table.toString());\n  }\n\n  if (result?.matchAlias && result.matchAlias.length > 0) {\n    let i = 1;\n    const table = createCliTable({horizontalLines: false});\n    table.push([{\n      colSpan: 2,\n      content: chalk.bold('Alias resolved'),\n      hAlign: 'center'\n    }]);\n    table.push([{hAlign: 'right', content: '--'}, '--------']);\n    for (const msg of result.matchAlias) {\n      table.push([{hAlign: 'right', content: i++}, msg]);\n    }\n    // eslint-disable-next-line no-console\n    console.log(table.toString());\n  }\n}\ninterface AnalyzeState {\n  inputFiles?: string[];\n  result?: ReturnType<Context['toPlainObject']> | null;\n}\n\nconst initState: AnalyzeState = {\n};\n\nconst slice = stateFactory.newSlice({\n  name: 'analyze',\n  initialState: initState,\n  reducers: createReducers({\n    /** payload: glob patterns */\n    analyzeFile(d: AnalyzeState, payload: {\n      files: string[]; tsconfig?: string; alias: [pattern: string, replace: string][]; ignore?: string;\n    }) {\n      d.inputFiles = payload.files;\n    }\n  })\n});\n\nexport function getStore() {\n  return stateFactory.sliceStore(slice);\n}\n\nexport const dispatcher = stateFactory.bindActionCreators(slice);\n\nstateFactory.addEpic<{analyze: AnalyzeState}>((action$, state$) => {\n  return merge(\n    action$.pipe(ofPayloadAction(slice.actions.analyzeFile),\n      mergeMap(({payload}) => analyseFiles(payload.files, payload.tsconfig, payload.alias, payload.ignore)),\n      map(result => {\n        dispatcher._change(s => s.result = result); // TODO merge result instead of 'assign' result\n      })\n    )\n  ).pipe(\n    catchError((err, src) => {\n      console.error(err);\n      return src;\n    }),\n    ignoreElements()\n  );\n});\n\n\nexport async function analyseFiles(files: string[],\n  tsconfigFile: string | undefined,\n  alias: [pattern: string, replace: string][],\n  ignore?: string) {\n  const matchDones = files.map(pattern => new Promise<string[]>((resolve, reject) => {\n    glob(pattern, {nodir: true}, (err, matches) => {\n      if (err) {\n        return reject(err);\n      }\n      resolve(matches);\n    });\n  }));\n  files = _.flatten((await Promise.all(matchDones)))\n  .filter(f => /\\.[jt]sx?$/.test(f));\n\n  if (files.length === 0) {\n    log.warn('No source files are found');\n    return null;\n  }\n  const threadPool = new Pool(cpus - 1, 0, {\n    // initializer: {file: 'source-map-support/register'},\n    verbose: false\n  });\n\n  return await threadPool.submitProcess<ReturnType<Context['toPlainObject']>>({\n    file: Path.resolve(__dirname, 'cli-analyse-worker.js'),\n    exportFn: 'dfsTraverseFiles',\n    args: [files.map(p => Path.resolve(p)), tsconfigFile, alias, ignore]\n  });\n\n}\n"]}
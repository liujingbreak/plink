{"version":3,"file":"cli-init.js","sourceRoot":"","sources":["../../ts/cmd/cli-init.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable no-console, max-len */\nimport Path from 'path';\nimport chalk from 'chalk';\nimport {merge} from 'rxjs';\nimport { distinctUntilChanged, map, skip, scan } from 'rxjs/operators';\nimport _ from 'lodash';\nimport { actionDispatcher as actions, getState, getStore, WorkspaceState} from '../package-mgr';\nimport {dispatcher as storeSettingDispatcher} from '../store';\nimport {createCliTable, plinkEnv} from '../utils/misc';\nimport { packages4WorkspaceKey } from '../package-utils';\nimport {listPackagesByProjects} from './cli-ls';\nimport '../editor-helper';\n// import { getRootDir } from '../utils/misc';\nimport { listProject } from './cli-project';\nimport * as options from './types';\n\nexport default function(opt: options.InitCmdOptions & options.NpmCliOption, workspace?: string) {\n  storeSettingDispatcher.changeActionOnExit('save');\n  getStore().pipe(\n    distinctUntilChanged((s1, s2) => s1.packagesUpdateChecksum === s2.packagesUpdateChecksum),\n    skip(1),\n    map(s => {\n      console.log(listPackagesByProjects(s));\n      printWorkspaces();\n    })\n  ).subscribe();\n\n  const existingWsKeys = getState().workspaces;\n\n  // print newly added workspace hoisted dependency information\n  getStore().pipe(map(s => s.lastCreatedWorkspace),\n    distinctUntilChanged(),\n    scan((prev, curr) => {\n      if (curr && !existingWsKeys.has(curr)) {\n        printWorkspaceHoistedDeps(getState().workspaces.get(curr)!);\n      }\n      return curr;\n    })\n  ).subscribe();\n\n  // print existing workspace CHANGED hoisted dependency information\n  merge(...Array.from(getState().workspaces.keys()).map(wsKey => getStore().pipe(\n    map(s => s.workspaces),\n    distinctUntilChanged(),\n    map(s => s.get(wsKey)),\n    distinctUntilChanged((s1, s2) => s1!.hoistInfo === s2!.hoistInfo && s1!.hoistPeerDepInfo === s2!.hoistPeerDepInfo),\n    scan((wsOld, wsNew) => {\n      // console.log('*****************', wsKey);\n      printWorkspaceHoistedDeps(wsNew!);\n      return wsNew;\n    })\n  ))).subscribe();\n\n  if (workspace) {\n    actions.updateWorkspace({dir: workspace, isForce: opt.force, useYarn: opt.useYarn,\n      cache: opt.cache, useNpmCi: opt.useCi});\n} else {\n  actions.initRootDir({isForce: opt.force,\n    useYarn: opt.useYarn, cache: opt.cache, useNpmCi: opt.useCi});\n  setImmediate(() => listProject());\n}\n  // setImmediate(() => printWorkspaces());\n}\n\nexport function printWorkspaces() {\n  const table = createCliTable({\n    horizontalLines: false,\n    colAligns: ['right', 'right']\n  });\n  const sep = ['--------------', '------------------', '------------', '----------', '-----'].map(item => chalk.gray(item));\n  table.push([{colSpan: 5, content: chalk.underline('Worktree Space and linked dependencies\\n'), hAlign: 'center'}],\n    ['WORKTREE SPACE', 'DEPENDENCY PACKAGE', 'EXPECTED VERSION', 'ACTUAL VERSION', 'SRC DIR'].map(item => chalk.gray(item)),\n    sep);\n\n  let wsIdx = 0;\n  const srcPkgs = getState().srcPackages;\n  for (const reldir of getState().workspaces.keys()) {\n    if (wsIdx > 0) {\n      table.push(sep);\n    }\n\n    let i = 0;\n    const pkJson = getState().workspaces.get(reldir)!.originInstallJson;\n    // console.log(pkJson);\n    let workspaceLabel = reldir ? `  ${reldir}` : '  (root directory)';\n    if (getState().currWorkspace === reldir) {\n      workspaceLabel = chalk.inverse(workspaceLabel);\n    } else {\n      workspaceLabel = chalk.gray(workspaceLabel);\n    }\n\n    for (const {name: dep, json: {version: ver}, isInstalled} of packages4WorkspaceKey(reldir)) {\n      const expectedVer = convertVersion(pkJson, dep);\n      const same = expectedVer === ver;\n      table.push([\n        i === 0 ? workspaceLabel : '',\n        same || !isInstalled ? dep : `${chalk.red('*')} ${dep}`,\n        same ? expectedVer : chalk.yellow(expectedVer),\n        ver,\n        isInstalled ? chalk.gray('(installed)') : Path.relative(plinkEnv.rootDir, srcPkgs.get(dep)!.realPath)\n      ]);\n      i++;\n    }\n    if (i === 0) {\n      table.push([workspaceLabel]);\n    }\n    wsIdx++;\n  }\n\n  console.log(table.toString());\n}\n\nfunction convertVersion(pkgJson: {\n  dependencies?: {[k: string]: string};\n  devDependencies?: {[k: string]: string};\n}, depName: string) {\n  let ver = pkgJson.dependencies ? pkgJson.dependencies[depName] : null;\n  if (ver == null && pkgJson.devDependencies) {\n    ver = pkgJson.devDependencies[depName];\n  }\n  if (ver == null) {\n    return '';\n  }\n  if (ver.startsWith('.') || ver.startsWith('file:')) {\n    const m = /\\-(\\d+(?:\\.\\d+){1,2}(?:-[^-]+)?)\\.tgz$/.exec(ver);\n    if (m) {\n      return m[1];\n    }\n  }\n  return ver;\n}\n\nexport function printWorkspaceHoistedDeps(workspace: WorkspaceState) {\n  console.log(chalk.bold(`\\nHoisted Transitive Dependency & Dependents (${workspace.id || '<root directory>'})`));\n  const table = createTable();\n  table.push(['DEPENDENCY', 'DEPENDENT'].map(item => chalk.gray(item)),\n    ['---', '---'].map(item => chalk.gray(item)));\n  for (const [dep, dependents] of workspace.hoistInfo.entries()) {\n    table.push(renderHoistDepInfo(dep, dependents));\n  }\n  console.log(table.toString());\n  if (workspace.hoistDevInfo.size > 0) {\n    const table = createTable();\n    table.push(['DEPENDENCY', 'DEPENDENT'].map(item => chalk.gray(item)),\n    ['---', '---'].map(item => chalk.gray(item)));\n    console.log(chalk.bold(`\\nHoisted Transitive (dev) Dependency & Dependents (${workspace.id || '<root directory>'})`));\n    for (const [dep, dependents] of workspace.hoistDevInfo.entries()) {\n      table.push(renderHoistDepInfo(dep, dependents));\n    }\n    console.log(table.toString());\n  }\n  if (workspace.hoistPeerDepInfo.size > 0) {\n    console.log(chalk.bold(`Hoisted Transitive Peer Dependencies (${workspace.id || '<root directory>'})`));\n    const table = createTable();\n    table.push(['DEPENDENCY', 'DEPENDENT'].map(item => chalk.gray(item)),\n    ['---', '---'].map(item => chalk.gray(item)));\n    for (const [dep, dependents] of workspace.hoistPeerDepInfo.entries()) {\n      table.push(renderHoistPeerDepInfo(dep, dependents));\n    }\n    console.log(table.toString());\n  }\n  if (workspace.hoistDevPeerDepInfo.size > 0) {\n    console.log(chalk.yellowBright(`\\nHoisted Transitive Peer Dependencies (dev) (${workspace.id || '<root directory>'})`));\n    const table = createTable();\n    table.push(['DEPENDENCY', 'DEPENDENT'].map(item => chalk.gray(item)),\n    ['---', '---'].map(item => chalk.gray(item)));\n    for (const [dep, dependents] of workspace.hoistDevPeerDepInfo.entries()) {\n      table.push(renderHoistPeerDepInfo(dep, dependents));\n    }\n    console.log(table.toString());\n  }\n  printColorExplaination(workspace);\n}\n\nfunction createTable() {\n  const table = createCliTable({\n    horizontalLines: false,\n    // style: {head: []},\n    colAligns: ['right', 'left']\n  });\n  return table;\n}\n\ntype DependentInfo = WorkspaceState['hoistInfo'] extends Map<string, infer T> ? T : unknown;\n\nfunction renderHoistDepInfo(dep: string, dependents: DependentInfo): [dep: string, ver: string] {\n  return [\n    dependents.sameVer ? dep : dependents.direct ? chalk.yellow(dep) : chalk.bgRed(dep),\n    dependents.by.map((item, idx) =>\n      `${dependents.direct && idx === 0 ? chalk.green(item.ver) : idx > 0 ? chalk.gray(item.ver) : chalk.cyan(item.ver)}: ${chalk.grey(item.name)}`\n    ).join('\\n')\n  ];\n}\nfunction renderHoistPeerDepInfo(dep: string, dependents: DependentInfo): [dep: string, ver: string] {\n  return [\n    dependents.missing ? chalk.yellow(dep) : (dependents.duplicatePeer ? dep : chalk.green(dep)),\n    dependents.by.map((item, idx) =>\n      `${dependents.direct && idx === 0 ? chalk.green(item.ver) : idx > 0 ? item.ver : chalk.cyan(item.ver)}: ${chalk.grey(item.name)}`\n    ).join('\\n')\n  ];\n}\n\nfunction printColorExplaination(workspace: WorkspaceState) {\n  const summary = workspace.hoistInfoSummary;\n  if (summary == null)\n    return;\n  if (summary.conflictDeps.length > 0) {\n    console.log(`Above listed transitive dependencies: \"${chalk.red(summary.conflictDeps.join(', '))}\" have ` +\n      'conflict dependency version, resolve them by choosing a version and add them to worktree space.\\n');\n  }\n  if (_.size(summary.missingDeps) > 0) {\n    console.log(`Above listed transitive peer dependencies in ${chalk.yellow('yellow')} should be added to worktree space as \"dependencies\":\\n` +\n      chalk.yellow(JSON.stringify(summary.missingDeps, null, '  ').replace(/^([^])/mg, (m, p1) => '  ' + p1) + '\\n'));\n  }\n  if (_.size(summary.missingDevDeps) > 0) {\n    console.log('Above listed transitive peer dependencies might should be added to worktree space as \"devDependencies\":\\n' +\n      chalk.yellow(JSON.stringify(summary.missingDevDeps, null, '  ').replace(/^([^])/mg, (m, p1) => '  ' + p1)) + '\\n');\n  }\n}\n"]}
{"version":3,"file":"log4js-appenders.js","sourceRoot":"","sources":["../../ts/utils/log4js-appenders.ts"],"names":[],"mappings":";;;AAIA,MAAM,EAAC,IAAI,EAAE,gBAAgB,EAAC,GAAG,OAAO,CAAC,uBAAuB,CAAoC,CAAC;AACrG,MAAM,EAAC,WAAW,EAAC,GAAG,OAAO,CAAC,yBAAyB,CAAiD,CAAC;AAEzG;;GAEG;AACU,QAAA,iBAAiB,GAAmB;IAC/C,SAAS,CAAC,OAAO,EAAE,QAAQ;QACzB,OAAO,cAAY,CAAC,CAAC;IACvB,CAAC;CACF,CAAC;AAEW,QAAA,oBAAoB,GAAmB;IAClD,SAAS,CAAC,OAAO,EAAE,QAAQ,EAAE,aAAa;QACxC,4GAA4G;QAC5G,IAAI,OAAO,CAAC,IAAI,IAAI,IAAI;YACtB,MAAM,IAAI,KAAK,CAAC,0EAA0E,CAAC,CAAC;QAE9F,OAAO,oBAAoB,CAAC;IAC9B,CAAC;CACF,CAAC;AAEF,SAAS,oBAAoB,CAAC,QAA+B;IAC3D,IAAI;QACF,OAAO,CAAC,IAAK,CAAC;YACZ,KAAK,EAAE,gBAAgB;YACvB,IAAI,EAAE,OAAO,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,SAAS,EAAE;SACrE,CAAC,CAAC;KACJ;IAAC,OAAO,CAAM,EAAE;QACf,OAAO,CAAC,KAAK,CAAC,wBAAwB,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;KACzD;AACH,CAAC;AAED;;GAEG;AACH,SAAgB,sBAAsB,CAAC,GAAmC,EAAE,QAAQ,GAAG,KAAK;IAC1F,IAAI,GAAG,IAAI,GAAG,CAAC,KAAK,KAAK,gBAAgB,EAAE;QACzC,MAAM,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC;QAC1B,IAAI,QAAQ,EAAE;YACZ,oBAAoB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;SAChC;aAAM;YACL,gBAAgB,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC;SACzC;QACD,0EAA0E;QAC1E,sCAAsC;QACtC,sCAAsC;QACtC,OAAO,IAAI,CAAC;KACb;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAdD,wDAcC","sourcesContent":["/**\n * https://log4js-node.github.io/log4js-node/writing-appenders.html\n */\nimport {AppenderModule, LoggingEvent} from 'log4js';\nconst {send: sendLoggingEvent} = require('log4js/lib/clustering') as {send(msg: LoggingEvent): void};\nconst {deserialise} = require('log4js/lib/LoggingEvent') as {deserialise: (msg: string) => LoggingEvent};\n\n/**\n * Log4js can handle cluster worker configuration, it will most likely ignore appenders, so it could be empty appender\n */\nexport const doNothingAppender: AppenderModule = {\n  configure(_config, _layouts) {\n    return function() {};\n  }\n};\n\nexport const childProcessAppender: AppenderModule = {\n  configure(_config, _layouts, _findAppender) {\n    // const layout = config.layout ? layouts.layout(config.layout.type, config.layout) : layouts.coloredLayout;\n    if (process.send == null)\n      throw new Error('Appender can not be used with process.send undefined (in master process)');\n\n    return emitLogEventToParent;\n  }\n};\n\nfunction emitLogEventToParent(logEvent: LoggingEvent | string) {\n  try {\n    process.send!({\n      topic: 'log4js:message',\n      data: typeof logEvent === 'string' ? logEvent : logEvent.serialise()\n    });\n  } catch (e: any) {\n    console.error(`emit log error, PID: ${process.pid}`, e);\n  }\n}\n\n/**\n * Emit log event to log4js appenders\n */\nexport function emitChildProcessLogMsg(msg: {topic?: string, data: string}, toParent = false) {\n  if (msg && msg.topic === 'log4js:message') {\n    const logEvent = msg.data;\n    if (toParent) {\n      emitLogEventToParent(msg.data);\n    } else {\n      sendLoggingEvent(deserialise(logEvent));\n    }\n    // getLogger(logEvent.categoryName).log(logEvent.level, ...logEvent.data);\n    // eslint-disable-next-line no-console\n    // console.log(process.pid, logEvent);\n    return true;\n  }\n  return false;\n}\n\n"]}
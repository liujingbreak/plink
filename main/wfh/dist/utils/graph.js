"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BFS = exports.DFS = exports.getPathTo = exports.Vertex = exports.Color = void 0;
var Color;
(function (Color) {
    /** unvisisted */
    Color[Color["white"] = 0] = "white";
    /** visiting */
    Color[Color["gray"] = 1] = "gray";
    /** visisted */
    Color[Color["black"] = 2] = "black";
})(Color = exports.Color || (exports.Color = {}));
class Vertex {
    constructor(data, color = Color.white) {
        this.data = data;
        this.color = color;
        /** discovery time */
        this.d = Number.MAX_VALUE;
    }
}
exports.Vertex = Vertex;
function getPathTo(v, temp = []) {
    if (v.p) {
        getPathTo(v.p[0], temp);
    }
    temp.push(v);
}
exports.getPathTo = getPathTo;
class BaseGraph {
    constructor() {
        this.vertexMap = new Map();
    }
    visit(g) {
        for (const data of g) {
            const u = this.vertexOf(data);
            if (u.color === Color.white) {
                this.visitVertex(u);
            }
        }
    }
    vertexOf(data) {
        if (this.vertexMap.has(data)) {
            return this.vertexMap.get(data);
        }
        else {
            const v = new Vertex(data);
            this.vertexMap.set(data, v);
            return v;
        }
    }
}
class DFS extends BaseGraph {
    // private vertexMap = new Map<T, Vertex<T>>();
    constructor(adjacencyOf, onFinish) {
        super();
        this.adjacencyOf = adjacencyOf;
        this.onFinish = onFinish;
        this.backEdges = [];
        this.time = 0;
        this.level = -1;
    }
    visit(g) {
        this.time = 0;
        super.visit(g);
    }
    printCyclicBackEdge(edge, edgeTo) {
        return [...this._printParentUntil(edge, edgeTo), edgeTo.data + ''];
    }
    _printParentUntil(edge, edgeAncestor) {
        if (edge == null) {
            return [];
        }
        if (edge === edgeAncestor) {
            return [edgeAncestor.data + ''];
        }
        if (edge.p)
            return [...this._printParentUntil(edge.p[0], edgeAncestor), edge.data + ''];
        else
            return ['? -> ', edge.data + ''];
    }
    visitVertex(u) {
        u.d = ++this.time;
        u.color = Color.gray;
        this.level++;
        for (const vData of this.adjacencyOf(u.data, u, this.level)) {
            const v = this.vertexOf(vData);
            if (v.color === Color.white) {
                v.p = [u];
                this.visitVertex(v);
            }
            else if (v.color === Color.gray) {
                this.backEdges.push([u, v]);
            }
            else {
                if (v.p == null)
                    v.p = [];
                v.p.push(u);
            }
        }
        u.color = Color.black;
        u.f = ++this.time;
        this.level--;
        if (this.onFinish)
            this.onFinish(u);
    }
}
exports.DFS = DFS;
class BFS extends BaseGraph {
    constructor(adjacencyOf) {
        super();
        this.adjacencyOf = adjacencyOf;
    }
    visitVertex(s) {
        s.color = Color.gray;
        s.d = 0;
        const q = [s];
        while (q.length > 0) {
            const u = q.shift();
            for (const vData of this.adjacencyOf(u.data, u)) {
                const v = this.vertexOf(vData);
                if (v.color === Color.white) {
                    v.color = Color.gray;
                    v.d = u.d + 1;
                    if (v.p == null)
                        v.p = [];
                    v.p.push(u);
                    q.push(v);
                }
            }
            u.color = Color.black;
        }
    }
}
exports.BFS = BFS;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi90cy91dGlscy9ncmFwaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxJQUFZLEtBT1g7QUFQRCxXQUFZLEtBQUs7SUFDZixpQkFBaUI7SUFDakIsbUNBQVMsQ0FBQTtJQUNULGVBQWU7SUFDZixpQ0FBSSxDQUFBO0lBQ0osZUFBZTtJQUNmLG1DQUFLLENBQUE7QUFDUCxDQUFDLEVBUFcsS0FBSyxHQUFMLGFBQUssS0FBTCxhQUFLLFFBT2hCO0FBRUQsTUFBYSxNQUFNO0lBUWpCLFlBQW1CLElBQU8sRUFBUyxRQUFRLEtBQUssQ0FBQyxLQUFLO1FBQW5DLFNBQUksR0FBSixJQUFJLENBQUc7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFjO1FBUHRELHFCQUFxQjtRQUNyQixNQUFDLEdBQVcsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQU83QixDQUFDO0NBQ0Y7QUFWRCx3QkFVQztBQUVELFNBQWdCLFNBQVMsQ0FBSSxDQUFZLEVBQUUsT0FBTyxFQUFpQjtJQUNqRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDUCxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztLQUN6QjtJQUNELElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDZixDQUFDO0FBTEQsOEJBS0M7QUFFRCxNQUFlLFNBQVM7SUFBeEI7UUFDWSxjQUFTLEdBQUcsSUFBSSxHQUFHLEVBQWdCLENBQUM7SUFzQmhELENBQUM7SUFwQkMsS0FBSyxDQUFDLENBQWM7UUFDbEIsS0FBSyxNQUFNLElBQUksSUFBSSxDQUFDLEVBQUU7WUFDcEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLEtBQUssRUFBRTtnQkFDM0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNyQjtTQUNGO0lBQ0gsQ0FBQztJQUlTLFFBQVEsQ0FBQyxJQUFPO1FBQ3hCLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDNUIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUUsQ0FBQztTQUNsQzthQUFNO1lBQ0wsTUFBTSxDQUFDLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLE9BQU8sQ0FBQyxDQUFDO1NBQ1Y7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxNQUFhLEdBQU8sU0FBUSxTQUFZO0lBS3RDLCtDQUErQztJQUUvQyxZQUFvQixXQUFvRSxFQUFVLFFBQXFDO1FBQ3JJLEtBQUssRUFBRSxDQUFDO1FBRFUsZ0JBQVcsR0FBWCxXQUFXLENBQXlEO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBNkI7UUFOdkksY0FBUyxHQUE2QixFQUFFLENBQUM7UUFFakMsU0FBSSxHQUFHLENBQUMsQ0FBQztRQUNULFVBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztJQUtuQixDQUFDO0lBRUQsS0FBSyxDQUFDLENBQWM7UUFDbEIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxtQkFBbUIsQ0FBQyxJQUFlLEVBQUUsTUFBaUI7UUFDcEQsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxJQUFlLEVBQUUsWUFBdUI7UUFDeEQsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO1lBQ2hCLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxJQUFJLElBQUksS0FBSyxZQUFZLEVBQUU7WUFDekIsT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUM7U0FDakM7UUFDRCxJQUFJLElBQUksQ0FBQyxDQUFDO1lBQ1IsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsWUFBWSxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQzs7WUFFNUUsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFUyxXQUFXLENBQUMsQ0FBWTtRQUNoQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztRQUNsQixDQUFDLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2IsS0FBSyxNQUFNLEtBQUssSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMzRCxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsS0FBSyxFQUFFO2dCQUMzQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNyQjtpQkFBTSxJQUFJLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLElBQUksRUFBRTtnQkFDakMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUM3QjtpQkFBTTtnQkFDTCxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSTtvQkFDYixDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDWCxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNiO1NBQ0Y7UUFDRCxDQUFDLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2IsSUFBSSxJQUFJLENBQUMsUUFBUTtZQUNmLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckIsQ0FBQztDQUNGO0FBeERELGtCQXdEQztBQUVELE1BQWEsR0FBTyxTQUFRLFNBQVk7SUFDdEMsWUFBb0IsV0FBcUQ7UUFDdkUsS0FBSyxFQUFFLENBQUM7UUFEVSxnQkFBVyxHQUFYLFdBQVcsQ0FBMEM7SUFFekUsQ0FBQztJQUVTLFdBQVcsQ0FBQyxDQUFZO1FBQ2hDLENBQUMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNSLE1BQU0sQ0FBQyxHQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLE9BQU8sQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRyxDQUFDO1lBQ3JCLEtBQUssTUFBTSxLQUFLLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFO2dCQUMvQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUMvQixJQUFJLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLEtBQUssRUFBRTtvQkFDM0IsQ0FBQyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO29CQUNyQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNkLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJO3dCQUNiLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNaLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ1g7YUFDRjtZQUNELENBQUMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztTQUN2QjtJQUNILENBQUM7Q0FDRjtBQXpCRCxrQkF5QkMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZW51bSBDb2xvciB7XG4gIC8qKiB1bnZpc2lzdGVkICovXG4gIHdoaXRlID0gMCxcbiAgLyoqIHZpc2l0aW5nICovXG4gIGdyYXksXG4gIC8qKiB2aXNpc3RlZCAqL1xuICBibGFja1xufVxuXG5leHBvcnQgY2xhc3MgVmVydGV4PFQ+IHtcbiAgLyoqIGRpc2NvdmVyeSB0aW1lICovXG4gIGQ6IG51bWJlciA9IE51bWJlci5NQVhfVkFMVUU7XG4gIC8qKiBmaW5pc2hpbmcgdGltZSwgdXNlZCB0byBjYWxjdWxhdGUgXCJTdHJvbmdseSBjb25uZWN0ZWQgY29tcG9uZW50c1wiIGFuZCBcIlRvcG9sb2dpY2FsIHNvcnRcIiAqL1xuICBmOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gIC8qKiBwYXJlbnQgdmVydGljZXMgKi9cbiAgcD86IFZlcnRleDxUPltdO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBkYXRhOiBULCBwdWJsaWMgY29sb3IgPSBDb2xvci53aGl0ZSkge1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQYXRoVG88VD4odjogVmVydGV4PFQ+LCB0ZW1wID0gW10gYXMgVmVydGV4PFQ+W10pIHtcbiAgaWYgKHYucCkge1xuICAgIGdldFBhdGhUbyh2LnBbMF0sIHRlbXApO1xuICB9XG4gIHRlbXAucHVzaCh2KTtcbn1cblxuYWJzdHJhY3QgY2xhc3MgQmFzZUdyYXBoPFQ+IHtcbiAgcHJvdGVjdGVkIHZlcnRleE1hcCA9IG5ldyBNYXA8VCwgVmVydGV4PFQ+PigpO1xuXG4gIHZpc2l0KGc6IEl0ZXJhYmxlPFQ+KSB7XG4gICAgZm9yIChjb25zdCBkYXRhIG9mIGcpIHtcbiAgICAgIGNvbnN0IHUgPSB0aGlzLnZlcnRleE9mKGRhdGEpO1xuICAgICAgaWYgKHUuY29sb3IgPT09IENvbG9yLndoaXRlKSB7XG4gICAgICAgIHRoaXMudmlzaXRWZXJ0ZXgodSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IHZpc2l0VmVydGV4KHU6IFZlcnRleDxUPik6IHZvaWQ7XG5cbiAgcHJvdGVjdGVkIHZlcnRleE9mKGRhdGE6IFQpIHtcbiAgICBpZiAodGhpcy52ZXJ0ZXhNYXAuaGFzKGRhdGEpKSB7XG4gICAgICByZXR1cm4gdGhpcy52ZXJ0ZXhNYXAuZ2V0KGRhdGEpITtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdiA9IG5ldyBWZXJ0ZXgoZGF0YSk7XG4gICAgICB0aGlzLnZlcnRleE1hcC5zZXQoZGF0YSwgdik7XG4gICAgICByZXR1cm4gdjtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIERGUzxUPiBleHRlbmRzIEJhc2VHcmFwaDxUPiB7XG4gIGJhY2tFZGdlczogW1ZlcnRleDxUPiwgVmVydGV4PFQ+XVtdID0gW107XG5cbiAgcHJpdmF0ZSB0aW1lID0gMDtcbiAgcHJpdmF0ZSBsZXZlbCA9IC0xO1xuICAvLyBwcml2YXRlIHZlcnRleE1hcCA9IG5ldyBNYXA8VCwgVmVydGV4PFQ+PigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYWRqYWNlbmN5T2Y6ICh1OiBULCB2ZXJ0ZXg6IFZlcnRleDxUPiwgbGV2ZWw6IG51bWJlcikgPT4gSXRlcmFibGU8VD4sIHByaXZhdGUgb25GaW5pc2g/OiAodmVydGV4OiBWZXJ0ZXg8VD4pID0+IGFueSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICB2aXNpdChnOiBJdGVyYWJsZTxUPikge1xuICAgIHRoaXMudGltZSA9IDA7XG4gICAgc3VwZXIudmlzaXQoZyk7XG4gIH1cblxuICBwcmludEN5Y2xpY0JhY2tFZGdlKGVkZ2U6IFZlcnRleDxUPiwgZWRnZVRvOiBWZXJ0ZXg8VD4pOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLl9wcmludFBhcmVudFVudGlsKGVkZ2UsIGVkZ2VUbyksIGVkZ2VUby5kYXRhICsgJyddO1xuICB9XG5cbiAgX3ByaW50UGFyZW50VW50aWwoZWRnZTogVmVydGV4PFQ+LCBlZGdlQW5jZXN0b3I6IFZlcnRleDxUPik6IHN0cmluZ1tdIHtcbiAgICBpZiAoZWRnZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGlmIChlZGdlID09PSBlZGdlQW5jZXN0b3IpIHtcbiAgICAgIHJldHVybiBbZWRnZUFuY2VzdG9yLmRhdGEgKyAnJ107XG4gICAgfVxuICAgIGlmIChlZGdlLnApXG4gICAgICByZXR1cm4gWy4uLnRoaXMuX3ByaW50UGFyZW50VW50aWwoZWRnZS5wWzBdLCBlZGdlQW5jZXN0b3IpLCBlZGdlLmRhdGEgKyAnJ107XG4gICAgZWxzZVxuICAgICAgcmV0dXJuIFsnPyAtPiAnLCBlZGdlLmRhdGEgKyAnJ107XG4gIH1cblxuICBwcm90ZWN0ZWQgdmlzaXRWZXJ0ZXgodTogVmVydGV4PFQ+KSB7XG4gICAgdS5kID0gKyt0aGlzLnRpbWU7XG4gICAgdS5jb2xvciA9IENvbG9yLmdyYXk7XG4gICAgdGhpcy5sZXZlbCsrO1xuICAgIGZvciAoY29uc3QgdkRhdGEgb2YgdGhpcy5hZGphY2VuY3lPZih1LmRhdGEsIHUsIHRoaXMubGV2ZWwpKSB7XG4gICAgICBjb25zdCB2ID0gdGhpcy52ZXJ0ZXhPZih2RGF0YSk7XG4gICAgICBpZiAodi5jb2xvciA9PT0gQ29sb3Iud2hpdGUpIHtcbiAgICAgICAgdi5wID0gW3VdO1xuICAgICAgICB0aGlzLnZpc2l0VmVydGV4KHYpO1xuICAgICAgfSBlbHNlIGlmICh2LmNvbG9yID09PSBDb2xvci5ncmF5KSB7XG4gICAgICAgIHRoaXMuYmFja0VkZ2VzLnB1c2goW3UsIHZdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh2LnAgPT0gbnVsbClcbiAgICAgICAgICB2LnAgPSBbXTtcbiAgICAgICAgdi5wLnB1c2godSk7XG4gICAgICB9XG4gICAgfVxuICAgIHUuY29sb3IgPSBDb2xvci5ibGFjaztcbiAgICB1LmYgPSArK3RoaXMudGltZTtcbiAgICB0aGlzLmxldmVsLS07XG4gICAgaWYgKHRoaXMub25GaW5pc2gpXG4gICAgICB0aGlzLm9uRmluaXNoKHUpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBCRlM8VD4gZXh0ZW5kcyBCYXNlR3JhcGg8VD4ge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFkamFjZW5jeU9mOiAodTogVCwgdmVydGV4OiBWZXJ0ZXg8VD4pID0+IEl0ZXJhYmxlPFQ+KSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB2aXNpdFZlcnRleChzOiBWZXJ0ZXg8VD4pIHtcbiAgICBzLmNvbG9yID0gQ29sb3IuZ3JheTtcbiAgICBzLmQgPSAwO1xuICAgIGNvbnN0IHE6IFZlcnRleDxUPltdID0gW3NdO1xuICAgIHdoaWxlIChxLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHUgPSBxLnNoaWZ0KCkhO1xuICAgICAgZm9yIChjb25zdCB2RGF0YSBvZiB0aGlzLmFkamFjZW5jeU9mKHUuZGF0YSwgdSkpIHtcbiAgICAgICAgY29uc3QgdiA9IHRoaXMudmVydGV4T2YodkRhdGEpO1xuICAgICAgICBpZiAodi5jb2xvciA9PT0gQ29sb3Iud2hpdGUpIHtcbiAgICAgICAgICB2LmNvbG9yID0gQ29sb3IuZ3JheTtcbiAgICAgICAgICB2LmQgPSB1LmQgKyAxO1xuICAgICAgICAgIGlmICh2LnAgPT0gbnVsbClcbiAgICAgICAgICAgIHYucCA9IFtdO1xuICAgICAgICAgIHYucC5wdXNoKHUpO1xuICAgICAgICAgIHEucHVzaCh2KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdS5jb2xvciA9IENvbG9yLmJsYWNrO1xuICAgIH1cbiAgfVxufVxuIl19
"use strict";
/* eslint-disable no-console */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const imap_msg_parser_1 = require("../mail/imap-msg-parser");
const rfc822_parser_1 = require("../mail/rfc822-parser");
const rfc822_sync_parser_1 = require("../mail/rfc822-sync-parser");
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
xdescribe('imap-msg-parser', () => {
    xit('createServerDataHandler() should parse string literal', (done) => {
        const handler = (0, imap_msg_parser_1.createServerDataHandler)();
        handler.output.subscribe(tks => console.log('lines:', tks), (err) => done.fail(err), () => done());
        const buf = Buffer.from('* OK 123\r\n* FETCH {14}abcdefghijklmn', 'utf8');
        handler.input(buf);
        handler.input(null);
    });
    it('parseLinesOfTokens() should work', async () => {
        const handler = (0, imap_msg_parser_1.createServerDataHandler)();
        const done = new Promise((resolve, rej) => {
            handler.output.subscribe(tks => { }, (err) => rej(err), () => resolve());
        });
        async function parse() {
            await (0, imap_msg_parser_1.parseLinesOfTokens)(handler.output, async (la) => {
                console.log('p1 parses line');
                while ((await la.la()) != null) {
                    const tk = await la.advance();
                    console.log('p1:', tk.text);
                    if (tk.type === imap_msg_parser_1.ImapTokenType.stringLit)
                        return true;
                }
            });
            console.log('p1 parsing completes');
            setTimeout(() => {
                handler.input(Buffer.from('* OK 789\r\n* FETCH2 {10}1234567890\r\n', 'utf8'));
                handler.input(null);
            }, 0);
            await (0, imap_msg_parser_1.parseLinesOfTokens)(handler.output, async (la) => {
                console.log('p2 parses line');
                while ((await la.la()) != null) {
                    const tk = await la.advance();
                    console.log('p2:', tk.text);
                }
            });
        }
        const parseDone = parse();
        const buf = Buffer.from('* OK 123\r\n* FETCH1 {14}abcdefghijklmn\r\n', 'utf8');
        setTimeout(() => {
            handler.input(buf);
        }, 0);
        await Promise.all([parseDone, done]);
    });
});
describe('rfc822-parser', () => {
    xit('parse()', async () => {
        const buf = fs_1.default.readFileSync(path_1.default.resolve(__dirname, '../../ts/spec/rfc822-msg.txt'));
        console.time('async');
        const result = await (0, rfc822_parser_1.parse)(buf);
        console.timeEnd('async');
        for (const part of result.parts) {
            console.log(part);
        }
    });
    xit('sync parse() case 1', () => {
        const buf = fs_1.default.readFileSync(path_1.default.resolve(__dirname, '../../ts/spec/rfc822-msg.txt'));
        console.time('sync');
        const result = (0, rfc822_sync_parser_1.parse)(buf);
        console.timeEnd('sync');
        for (const part of result.parts) {
            console.log(part);
        }
    });
    it('sync parse() case 2', () => {
        const buf = fs_1.default.readFileSync(path_1.default.resolve(__dirname, '../../ts/spec/rfc822-msg-2.txt'));
        console.time('sync');
        const result = (0, rfc822_sync_parser_1.parse)(buf);
        console.timeEnd('sync');
        for (const part of result.parts) {
            console.log(part.headers);
            if (part.file)
                console.log(part.file);
            else
                console.log(part.body.toString('utf8'));
        }
    });
    it('sync parse() message without attachment', () => {
        const buf = fs_1.default.readFileSync(path_1.default.resolve(__dirname, '../../ts/spec/plain-msg.txt'));
        console.time('sync');
        const result = (0, rfc822_sync_parser_1.parse)(buf);
        console.timeEnd('sync');
        console.log(result);
        // for (const part of result.parts) {
        //   console.log(part);
        // }
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hcC1tc2ctcGFyc2VyU3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImltYXAtbXNnLXBhcnNlclNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLCtCQUErQjs7Ozs7QUFFL0IsNkRBQW1HO0FBQ25HLHlEQUE0QztBQUM1QyxtRUFBOEQ7QUFDOUQsNENBQW9CO0FBQ3BCLGdEQUF3QjtBQUV4QixTQUFTLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLEdBQUcsQ0FBQyx1REFBdUQsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ3BFLE1BQU0sT0FBTyxHQUFHLElBQUEseUNBQXVCLEdBQUUsQ0FBQztRQUMxQyxPQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FDdEIsR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsRUFDakMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQ3ZCLEdBQUcsRUFBRSxDQUFDLElBQUksRUFBRSxDQUNiLENBQUM7UUFFRixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLHdDQUF3QyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkIsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNoRCxNQUFNLE9BQU8sR0FBRyxJQUFBLHlDQUF1QixHQUFFLENBQUM7UUFFMUMsTUFBTSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQU8sQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLEVBQUU7WUFDNUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQ3hCLEdBQUcsQ0FBQyxF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QUM7U0FDNUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7UUFDakQsTUFBTSxHQUFHLEdBQUcsWUFBRSxDQUFDLFlBQVksQ0FBQyxjQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDLENBQUM7UUFDcEYsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQixNQUFNLE1BQU0sR0FBRyxJQUFBLDBCQUFTLEVBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BCLHFDQUFxQztRQUNyQyx1QkFBdUI7UUFDdkIsSUFBSTtJQUNOLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG5cbmltcG9ydCB7Y3JlYXRlU2VydmVyRGF0YUhhbmRsZXIsIHBhcnNlTGluZXNPZlRva2VucywgSW1hcFRva2VuVHlwZX0gZnJvbSAnLi4vbWFpbC9pbWFwLW1zZy1wYXJzZXInO1xuaW1wb3J0IHtwYXJzZX0gZnJvbSAnLi4vbWFpbC9yZmM4MjItcGFyc2VyJztcbmltcG9ydCB7cGFyc2UgYXMgcGFyc2VTeW5jfSBmcm9tICcuLi9tYWlsL3JmYzgyMi1zeW5jLXBhcnNlcic7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IFBhdGggZnJvbSAncGF0aCc7XG5cbnhkZXNjcmliZSgnaW1hcC1tc2ctcGFyc2VyJywgKCkgPT4ge1xuICB4aXQoJ2NyZWF0ZVNlcnZlckRhdGFIYW5kbGVyKCkgc2hvdWxkIHBhcnNlIHN0cmluZyBsaXRlcmFsJywgKGRvbmUpID0+IHtcbiAgICBjb25zdCBoYW5kbGVyID0gY3JlYXRlU2VydmVyRGF0YUhhbmRsZXIoKTtcbiAgICBoYW5kbGVyLm91dHB1dC5zdWJzY3JpYmUoXG4gICAgICB0a3MgPT4gY29uc29sZS5sb2coJ2xpbmVzOicsIHRrcyksXG4gICAgICAoZXJyKSA9PiBkb25lLmZhaWwoZXJyKSxcbiAgICAgICgpID0+IGRvbmUoKVxuICAgICk7XG5cbiAgICBjb25zdCBidWYgPSBCdWZmZXIuZnJvbSgnKiBPSyAxMjNcXHJcXG4qIEZFVENIIHsxNH1hYmNkZWZnaGlqa2xtbicsICd1dGY4Jyk7XG4gICAgaGFuZGxlci5pbnB1dChidWYpO1xuICAgIGhhbmRsZXIuaW5wdXQobnVsbCk7XG4gIH0pO1xuXG4gIGl0KCdwYXJzZUxpbmVzT2ZUb2tlbnMoKSBzaG91bGQgd29yaycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBoYW5kbGVyID0gY3JlYXRlU2VydmVyRGF0YUhhbmRsZXIoKTtcblxuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqKSA9PiB7XG4gICAgICAgIGhhbmRsZXIub3V0cHV0LnN1YnNjcmliZShcbiAgICAgICAgdGtzID0+IHt9LFxuICAgICAgICAoZXJyKSA9PiByZWooZXJyKSxcbiAgICAgICAgKCkgPT4gcmVzb2x2ZSgpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgYXN5bmMgZnVuY3Rpb24gcGFyc2UoKSB7XG4gICAgICBhd2FpdCBwYXJzZUxpbmVzT2ZUb2tlbnMoaGFuZGxlci5vdXRwdXQsIGFzeW5jIGxhID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3AxIHBhcnNlcyBsaW5lJyk7XG4gICAgICAgIHdoaWxlICgoYXdhaXQgbGEubGEoKSkgIT0gbnVsbCkge1xuICAgICAgICAgIGNvbnN0IHRrID0gYXdhaXQgbGEuYWR2YW5jZSgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdwMTonLCB0ay50ZXh0KTtcbiAgICAgICAgICBpZiAodGsudHlwZSA9PT0gSW1hcFRva2VuVHlwZS5zdHJpbmdMaXQpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZygncDEgcGFyc2luZyBjb21wbGV0ZXMnKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBoYW5kbGVyLmlucHV0KEJ1ZmZlci5mcm9tKCcqIE9LIDc4OVxcclxcbiogRkVUQ0gyIHsxMH0xMjM0NTY3ODkwXFxyXFxuJywgJ3V0ZjgnKSk7XG4gICAgICAgIGhhbmRsZXIuaW5wdXQobnVsbCk7XG4gICAgICB9LCAwKTtcbiAgICAgIGF3YWl0IHBhcnNlTGluZXNPZlRva2VucyhoYW5kbGVyLm91dHB1dCwgYXN5bmMgbGEgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygncDIgcGFyc2VzIGxpbmUnKTtcbiAgICAgICAgd2hpbGUgKChhd2FpdCBsYS5sYSgpKSAhPSBudWxsKSB7XG4gICAgICAgICAgY29uc3QgdGsgPSBhd2FpdCBsYS5hZHZhbmNlKCk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3AyOicsIHRrLnRleHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgcGFyc2VEb25lID0gcGFyc2UoKTtcbiAgICBjb25zdCBidWYgPSBCdWZmZXIuZnJvbSgnKiBPSyAxMjNcXHJcXG4qIEZFVENIMSB7MTR9YWJjZGVmZ2hpamtsbW5cXHJcXG4nLCAndXRmOCcpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaGFuZGxlci5pbnB1dChidWYpO1xuICAgIH0sIDApO1xuXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoW3BhcnNlRG9uZSwgZG9uZV0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgncmZjODIyLXBhcnNlcicsICgpID0+IHtcbiAgeGl0KCdwYXJzZSgpJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGJ1ZiA9IGZzLnJlYWRGaWxlU3luYyhQYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vLi4vdHMvc3BlYy9yZmM4MjItbXNnLnR4dCcpKTtcbiAgICBjb25zb2xlLnRpbWUoJ2FzeW5jJyk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGFyc2UoYnVmKTtcbiAgICBjb25zb2xlLnRpbWVFbmQoJ2FzeW5jJyk7XG4gICAgZm9yIChjb25zdCBwYXJ0IG9mIHJlc3VsdC5wYXJ0cykge1xuICAgICAgY29uc29sZS5sb2cocGFydCk7XG4gICAgfVxuICB9KTtcblxuICB4aXQoJ3N5bmMgcGFyc2UoKSBjYXNlIDEnLCAoKSA9PiB7XG4gICAgY29uc3QgYnVmID0gZnMucmVhZEZpbGVTeW5jKFBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi8uLi90cy9zcGVjL3JmYzgyMi1tc2cudHh0JykpO1xuICAgIGNvbnNvbGUudGltZSgnc3luYycpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlU3luYyhidWYpO1xuICAgIGNvbnNvbGUudGltZUVuZCgnc3luYycpO1xuICAgIGZvciAoY29uc3QgcGFydCBvZiByZXN1bHQucGFydHMpIHtcbiAgICAgIGNvbnNvbGUubG9nKHBhcnQpO1xuICAgIH1cbiAgfSk7XG5cbiAgaXQoJ3N5bmMgcGFyc2UoKSBjYXNlIDInLCAoKSA9PiB7XG4gICAgY29uc3QgYnVmID0gZnMucmVhZEZpbGVTeW5jKFBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi8uLi90cy9zcGVjL3JmYzgyMi1tc2ctMi50eHQnKSk7XG4gICAgY29uc29sZS50aW1lKCdzeW5jJyk7XG4gICAgY29uc3QgcmVzdWx0ID0gcGFyc2VTeW5jKGJ1Zik7XG4gICAgY29uc29sZS50aW1lRW5kKCdzeW5jJyk7XG4gICAgZm9yIChjb25zdCBwYXJ0IG9mIHJlc3VsdC5wYXJ0cykge1xuICAgICAgY29uc29sZS5sb2cocGFydC5oZWFkZXJzKTtcbiAgICAgIGlmIChwYXJ0LmZpbGUpXG4gICAgICAgIGNvbnNvbGUubG9nKHBhcnQuZmlsZSk7XG4gICAgICBlbHNlXG4gICAgICAgIGNvbnNvbGUubG9nKHBhcnQuYm9keSEudG9TdHJpbmcoJ3V0ZjgnKSk7XG4gICAgfVxuICB9KTtcblxuICBpdCgnc3luYyBwYXJzZSgpIG1lc3NhZ2Ugd2l0aG91dCBhdHRhY2htZW50JywgKCkgPT4ge1xuICAgIGNvbnN0IGJ1ZiA9IGZzLnJlYWRGaWxlU3luYyhQYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vLi4vdHMvc3BlYy9wbGFpbi1tc2cudHh0JykpO1xuICAgIGNvbnNvbGUudGltZSgnc3luYycpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHBhcnNlU3luYyhidWYpO1xuICAgIGNvbnNvbGUudGltZUVuZCgnc3luYycpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gICAgLy8gZm9yIChjb25zdCBwYXJ0IG9mIHJlc3VsdC5wYXJ0cykge1xuICAgIC8vICAgY29uc29sZS5sb2cocGFydCk7XG4gICAgLy8gfVxuICB9KTtcbn0pO1xuIl19
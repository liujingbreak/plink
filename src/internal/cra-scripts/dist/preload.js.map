{"version":3,"file":"preload.js","sourceRoot":"","sources":["preload.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\n/**\n * Do not actually import entity other than \"type\" from here\n * Because we have not set node path yet.\n */\nimport Path from 'path';\nimport {sep} from 'path';\nimport fs from 'fs-extra';\nimport {hookCommonJsRequire} from '@wfh/plink/wfh/dist/loaderHooks';\nimport {drawPuppy} from './utils';\nimport _paths from './cra-scripts-paths';\nimport {getCmdOptions} from './utils';\nimport {hackWebpack4Compiler} from './hack-webpack-api';\nimport {register as registerForkTsChecker} from './hack-fork-ts-checker';\n// Avoid child process require us!\nconst deleteExecArgIdx: number[] = [];\nfor (let i = 0, l = process.execArgv.length; i < l; i++) {\n  if (i < l - 1 && /^(?:-r|--require)$/.test(process.execArgv[i]) &&\n  /^@wfh\\/cra-scripts($|\\/)/.test(process.execArgv[i + 1])) {\n    deleteExecArgIdx.push(i);\n  }\n}\ndeleteExecArgIdx.reduce((offset, deleteIdx) => {\n  process.execArgv.splice(deleteIdx + offset, 2);\n  return offset + 2;\n}, 0);\n\nexport function poo() {\n  const getCraPaths = (require('./cra-scripts-paths') as {default: typeof _paths}).default;\n\n  const reactScriptsPath = Path.resolve('node_modules/react-scripts');\n  // const reactDevUtilsPath = Path.resolve('node_modules/react-dev-utils');\n  const buildScriptsPath = Path.resolve('node_modules', 'react-scripts', 'scripts', 'build.js');\n\n  const reactWebpackCfg = Path.resolve('node_modules/react-scripts/config/webpack.config.js');\n  const reactWebpackDevServerCfg = Path.resolve('node_modules/react-scripts/config/webpackDevServer.config.js');\n  const clearConsole = Path.resolve('node_modules/react-dev-utils/clearConsole.js');\n  const craPaths = Path.resolve('node_modules/react-scripts/config/paths.js');\n\n  const craPackagesPathPrefix = Path.resolve('node_modules/react-');\n\n  // Disable @pmmmwh/react-refresh-webpack-plugin, since it excludes our node_modules\n  // from HMR\n  process.env.FAST_REFRESH = 'false';\n\n  hookCommonJsRequire((filename, target, req, resolve) => {\n    if (filename.startsWith(reactScriptsPath + sep)) {\n      if (filename === buildScriptsPath) {\n        if (target === 'fs-extra' && getCmdOptions().buildType === 'lib') {\n          // Disable copy public path\n          return Object.assign({}, fs, {\n            copySync(src: string) {\n              console.log('[prepload] skip copy ', src);\n            }\n          });\n        }\n        if (target === 'webpack') {\n          return hackWebpack4Compiler();\n        }\n      }\n      switch (resolve(target)) {\n        case reactWebpackCfg:\n          return require('./webpack.config');\n        case reactWebpackDevServerCfg:\n          return require('./webpack.devserver.config');\n        case clearConsole:\n          return noClearConsole;\n        case craPaths:\n          return getCraPaths();\n        default:\n      }\n      if (target === 'react-dev-utils/openBrowser') {\n        return require('./cra-open-browser').default;\n      }\n    } else if (filename.startsWith(craPackagesPathPrefix)) {\n      switch (resolve(target)) {\n        case craPaths:\n          return getCraPaths();\n        case clearConsole:\n          return noClearConsole;\n        default:\n      }\n    }\n  });\n\n  registerForkTsChecker();\n}\n\n\n\nfunction noClearConsole() {\n  // origClearConsole();\n  drawPuppy('pooed on create-react-app');\n}\n"]}
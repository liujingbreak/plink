"use strict";
/**
 * This file is not used actually. This is an attempt to patch Tsconfig file of fock-ts-checker-webpack-plugin 4.1.6.
 * The actual working solution is hack-fork-ts-checker.ts
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ForkTsCheckerExtend = void 0;
const fork_ts_checker_webpack_plugin_1 = __importDefault(require("fork-ts-checker-webpack-plugin"));
const misc_1 = require("@wfh/plink/wfh/dist/utils/misc");
const package_mgr_1 = require("@wfh/plink/wfh/dist/package-mgr");
const plink_1 = require("@wfh/plink");
const typescript_1 = __importDefault(require("typescript"));
const utils_1 = require("./utils");
const path_1 = __importDefault(require("path"));
const fs_1 = __importDefault(require("fs"));
// const log = log4File(__filename);
class ForkTsCheckerExtend extends fork_ts_checker_webpack_plugin_1.default {
    constructor(opts) {
        if (opts != null) {
            const plinkRoot = plink_1.plinkEnv.rootDir;
            const rootDir = (0, misc_1.closestCommonParentDir)(Array.from((0, package_mgr_1.getState)().project2Packages.keys()).map(prjDir => path_1.default.resolve(plinkRoot, prjDir))).replace(/\\/g, '/');
            const tsconfigJson = typescript_1.default.readConfigFile(opts.tsconfig, (file) => fs_1.default.readFileSync(file, 'utf-8')).config;
            const tsconfigDir = path_1.default.dirname(opts.tsconfig);
            // CRA does not allow we configure "compilerOptions.paths"
            // (see create-react-app/packages/react-scripts/scripts/utils/verifyTypeScriptSetup.js)
            // therefore, initial paths is always empty.
            const pathMapping = tsconfigJson.compilerOptions.paths = {};
            if (tsconfigJson.compilerOptions.baseUrl == null) {
                tsconfigJson.compilerOptions.baseUrl = './';
            }
            for (const [name, { realPath }] of (0, package_mgr_1.getState)().srcPackages.entries() || []) {
                const realDir = path_1.default.relative(tsconfigDir, realPath).replace(/\\/g, '/');
                pathMapping[name] = [realDir];
                pathMapping[name + '/*'] = [realDir + '/*'];
            }
            if ((0, package_mgr_1.getState)().linkedDrcp) {
                const drcpDir = path_1.default.relative(tsconfigDir, (0, package_mgr_1.getState)().linkedDrcp.realPath).replace(/\\/g, '/');
                pathMapping['@wfh/plink'] = [drcpDir];
                pathMapping['@wfh/plink/*'] = [drcpDir + '/*'];
            }
            tsconfigJson.compilerOptions.paths = pathMapping;
            (0, plink_1.setTsCompilerOptForNodePath)(tsconfigDir, './', tsconfigJson.compilerOptions, {
                workspaceDir: plink_1.plinkEnv.workDir || process.cwd()
            });
            (0, utils_1.runTsConfigHandlers)(tsconfigJson.compilerOptions);
            tsconfigJson.include = [path_1.default.relative(plink_1.plinkEnv.workDir || process.cwd(), process.env._plink_cra_scripts_indexJs)];
            tsconfigJson.compilerOptions.rootDir = rootDir;
            opts.compilerOptions = tsconfigJson.compilerOptions;
        }
        super(opts);
    }
}
exports.ForkTsCheckerExtend = ForkTsCheckerExtend;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9yay10cy1jaGVja2VyLWV4dGVuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZvcmstdHMtY2hlY2tlci1leHRlbmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7O0FBRUgsb0dBQXdFO0FBQ3hFLHlEQUFzRTtBQUN0RSxpRUFBeUQ7QUFDekQsc0NBQWlFO0FBQ2pFLDREQUE0QjtBQUM1QixtQ0FBNEM7QUFDNUMsZ0RBQXdCO0FBQ3hCLDRDQUFvQjtBQUNwQixvQ0FBb0M7QUFFcEMsTUFBYSxtQkFBb0IsU0FBUSx3Q0FBMEI7SUFFakUsWUFBWSxJQUFpRTtRQUMzRSxJQUFJLElBQUksSUFBSSxJQUFJLEVBQUU7WUFDaEIsTUFBTSxTQUFTLEdBQUcsZ0JBQVEsQ0FBQyxPQUFPLENBQUM7WUFDbkMsTUFBTSxPQUFPLEdBQUcsSUFBQSw2QkFBc0IsRUFBQyxLQUFLLENBQUMsSUFBSSxDQUMvQyxJQUFBLHNCQUFRLEdBQUUsQ0FBQyxnQkFBZ0IsQ0FBaXpHLElBQUksRUFBRSxDQUNqMUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxjQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztZQUV4RSxNQUFNLFlBQVksR0FDaEIsb0JBQUUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVMsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsWUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDckYsTUFBTSxXQUFXLEdBQUcsY0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUyxDQUFDLENBQUM7WUFFakQsMERBQTBEO1lBQzFELHVGQUF1RjtZQUN2Riw0Q0FBNEM7WUFDNUMsTUFBTSxXQUFXLEdBQThCLFlBQVksQ0FBQyxlQUFlLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUN2RixJQUFJLFlBQVksQ0FBQyxlQUFlLENBQUMsT0FBTyxJQUFJLElBQUksRUFBRTtnQkFDaEQsWUFBWSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO2FBQzdDO1lBQ0QsS0FBSyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUMsUUFBUSxFQUFDLENBQUMsSUFBSSxJQUFBLHNCQUFRLEdBQUUsQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFFO2dCQUN2RSxNQUFNLE9BQU8sR0FBRyxjQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUN6RSxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDOUIsV0FBVyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQzthQUM3QztZQUVELElBQUksSUFBQSxzQkFBUSxHQUFFLENBQUMsVUFBVSxFQUFFO2dCQUN6QixNQUFNLE9BQU8sR0FBRyxjQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxJQUFBLHNCQUFRLEdBQUUsQ0FBQyxVQUFXLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDaEcsV0FBVyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3RDLFdBQVcsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQzthQUNoRDtZQUNELFlBQVksQ0FBQyxlQUFlLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQztZQUVqRCxJQUFBLG1DQUEyQixFQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsWUFBWSxDQUFDLGVBQWUsRUFBRTtnQkFDM0UsWUFBWSxFQUFFLGdCQUFRLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQUU7YUFDaEQsQ0FBQyxDQUFDO1lBQ0gsSUFBQSwyQkFBbUIsRUFBQyxZQUFZLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFbEQsWUFBWSxDQUFDLE9BQU8sR0FBRyxDQUFDLGNBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQVEsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTJCLENBQUMsQ0FBQyxDQUFDO1lBQ25ILFlBQVksQ0FBQyxlQUFlLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUMvQyxJQUFJLENBQUMsZUFBZSxHQUFHLFlBQVksQ0FBQyxlQUFlLENBQUM7U0FDckQ7UUFDRCxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUE1Q0Qsa0RBNENDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGlzIGZpbGUgaXMgbm90IHVzZWQgYWN0dWFsbHkuIFRoaXMgaXMgYW4gYXR0ZW1wdCB0byBwYXRjaCBUc2NvbmZpZyBmaWxlIG9mIGZvY2stdHMtY2hlY2tlci13ZWJwYWNrLXBsdWdpbiA0LjEuNi5cbiAqIFRoZSBhY3R1YWwgd29ya2luZyBzb2x1dGlvbiBpcyBoYWNrLWZvcmstdHMtY2hlY2tlci50c1xuICovXG5cbmltcG9ydCBGb3JrVHNDaGVja2VyV2VicGFja1BsdWdpbiBmcm9tICdmb3JrLXRzLWNoZWNrZXItd2VicGFjay1wbHVnaW4nO1xuaW1wb3J0IHtjbG9zZXN0Q29tbW9uUGFyZW50RGlyfSBmcm9tICdAd2ZoL3BsaW5rL3dmaC9kaXN0L3V0aWxzL21pc2MnO1xuaW1wb3J0IHtnZXRTdGF0ZX0gZnJvbSAnQHdmaC9wbGluay93ZmgvZGlzdC9wYWNrYWdlLW1ncic7XG5pbXBvcnQge3NldFRzQ29tcGlsZXJPcHRGb3JOb2RlUGF0aCwgcGxpbmtFbnZ9IGZyb20gJ0B3ZmgvcGxpbmsnO1xuaW1wb3J0IHRzIGZyb20gJ3R5cGVzY3JpcHQnO1xuaW1wb3J0IHtydW5Uc0NvbmZpZ0hhbmRsZXJzfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBQYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbi8vIGNvbnN0IGxvZyA9IGxvZzRGaWxlKF9fZmlsZW5hbWUpO1xuXG5leHBvcnQgY2xhc3MgRm9ya1RzQ2hlY2tlckV4dGVuZCBleHRlbmRzIEZvcmtUc0NoZWNrZXJXZWJwYWNrUGx1Z2luIHtcblxuICBjb25zdHJ1Y3RvcihvcHRzOiBDb25zdHJ1Y3RvclBhcmFtZXRlcnM8dHlwZW9mIEZvcmtUc0NoZWNrZXJXZWJwYWNrUGx1Z2luPlswXSkgIHtcbiAgICBpZiAob3B0cyAhPSBudWxsKSB7XG4gICAgICBjb25zdCBwbGlua1Jvb3QgPSBwbGlua0Vudi5yb290RGlyO1xuICAgICAgY29uc3Qgcm9vdERpciA9IGNsb3Nlc3RDb21tb25QYXJlbnREaXIoQXJyYXkuZnJvbShcbiAgICAgICAgZ2V0U3RhdGUoKS5wcm9qZWN0MlBhY2thZ2VzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5rZXlzKClcbiAgICAgICAgKS5tYXAocHJqRGlyID0+IFBhdGgucmVzb2x2ZShwbGlua1Jvb3QsIHByakRpcikpKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG5cbiAgICAgIGNvbnN0IHRzY29uZmlnSnNvbjoge2NvbXBpbGVyT3B0aW9uczogYW55LCBpbmNsdWRlPzogc3RyaW5nW119ID1cbiAgICAgICAgdHMucmVhZENvbmZpZ0ZpbGUob3B0cy50c2NvbmZpZyEsIChmaWxlKSA9PiBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0Zi04JykpLmNvbmZpZztcbiAgICAgIGNvbnN0IHRzY29uZmlnRGlyID0gUGF0aC5kaXJuYW1lKG9wdHMudHNjb25maWchKTtcblxuICAgICAgLy8gQ1JBIGRvZXMgbm90IGFsbG93IHdlIGNvbmZpZ3VyZSBcImNvbXBpbGVyT3B0aW9ucy5wYXRoc1wiXG4gICAgICAvLyAoc2VlIGNyZWF0ZS1yZWFjdC1hcHAvcGFja2FnZXMvcmVhY3Qtc2NyaXB0cy9zY3JpcHRzL3V0aWxzL3ZlcmlmeVR5cGVTY3JpcHRTZXR1cC5qcylcbiAgICAgIC8vIHRoZXJlZm9yZSwgaW5pdGlhbCBwYXRocyBpcyBhbHdheXMgZW1wdHkuXG4gICAgICBjb25zdCBwYXRoTWFwcGluZzoge1trZXk6IHN0cmluZ106IHN0cmluZ1tdfSA9IHRzY29uZmlnSnNvbi5jb21waWxlck9wdGlvbnMucGF0aHMgPSB7fTtcbiAgICAgIGlmICh0c2NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLmJhc2VVcmwgPT0gbnVsbCkge1xuICAgICAgICB0c2NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLmJhc2VVcmwgPSAnLi8nO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBbbmFtZSwge3JlYWxQYXRofV0gb2YgZ2V0U3RhdGUoKS5zcmNQYWNrYWdlcy5lbnRyaWVzKCkgfHwgW10pIHtcbiAgICAgICAgY29uc3QgcmVhbERpciA9IFBhdGgucmVsYXRpdmUodHNjb25maWdEaXIsIHJlYWxQYXRoKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG4gICAgICAgIHBhdGhNYXBwaW5nW25hbWVdID0gW3JlYWxEaXJdO1xuICAgICAgICBwYXRoTWFwcGluZ1tuYW1lICsgJy8qJ10gPSBbcmVhbERpciArICcvKiddO1xuICAgICAgfVxuXG4gICAgICBpZiAoZ2V0U3RhdGUoKS5saW5rZWREcmNwKSB7XG4gICAgICAgIGNvbnN0IGRyY3BEaXIgPSBQYXRoLnJlbGF0aXZlKHRzY29uZmlnRGlyLCBnZXRTdGF0ZSgpLmxpbmtlZERyY3AhLnJlYWxQYXRoKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG4gICAgICAgIHBhdGhNYXBwaW5nWydAd2ZoL3BsaW5rJ10gPSBbZHJjcERpcl07XG4gICAgICAgIHBhdGhNYXBwaW5nWydAd2ZoL3BsaW5rLyonXSA9IFtkcmNwRGlyICsgJy8qJ107XG4gICAgICB9XG4gICAgICB0c2NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLnBhdGhzID0gcGF0aE1hcHBpbmc7XG5cbiAgICAgIHNldFRzQ29tcGlsZXJPcHRGb3JOb2RlUGF0aCh0c2NvbmZpZ0RpciwgJy4vJywgdHNjb25maWdKc29uLmNvbXBpbGVyT3B0aW9ucywge1xuICAgICAgICB3b3Jrc3BhY2VEaXI6IHBsaW5rRW52LndvcmtEaXIgfHwgcHJvY2Vzcy5jd2QoKVxuICAgICAgfSk7XG4gICAgICBydW5Uc0NvbmZpZ0hhbmRsZXJzKHRzY29uZmlnSnNvbi5jb21waWxlck9wdGlvbnMpO1xuXG4gICAgICB0c2NvbmZpZ0pzb24uaW5jbHVkZSA9IFtQYXRoLnJlbGF0aXZlKHBsaW5rRW52LndvcmtEaXIgfHwgcHJvY2Vzcy5jd2QoKSwgcHJvY2Vzcy5lbnYuX3BsaW5rX2NyYV9zY3JpcHRzX2luZGV4SnMhKV07XG4gICAgICB0c2NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLnJvb3REaXIgPSByb290RGlyO1xuICAgICAgb3B0cy5jb21waWxlck9wdGlvbnMgPSB0c2NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zO1xuICAgIH1cbiAgICBzdXBlcihvcHRzKTtcbiAgfVxufVxuIl19
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TagKind = exports.TokenType = exports.lexer = exports.HtmlTokenType = void 0;
/* eslint-disable  max-classes-per-file, max-len, no-console, jsdoc/check-alignment, jsdoc/check-indentation, jsdoc/newline-after-description */
/**
 * TODO: Support parsing file with <script></script> tag contains special JS character like "<" and ">"
 */
// import {Token, BaseParser, BaseLexer} from '@wfh/plink/wfh/dist/base-LLn-parser';
const LLn_parser_1 = require("@wfh/plink/wfh/dist/LLn-parser");
var HtmlTokenType;
(function (HtmlTokenType) {
    // comments,
    HtmlTokenType[HtmlTokenType["<"] = 0] = "<";
    HtmlTokenType[HtmlTokenType[">"] = 1] = ">";
    HtmlTokenType[HtmlTokenType["/>"] = 2] = "/>";
    HtmlTokenType[HtmlTokenType["("] = 3] = "(";
    HtmlTokenType[HtmlTokenType[")"] = 4] = ")";
    HtmlTokenType[HtmlTokenType["["] = 5] = "[";
    HtmlTokenType[HtmlTokenType["]"] = 6] = "]";
    HtmlTokenType[HtmlTokenType["</"] = 7] = "</";
    HtmlTokenType[HtmlTokenType["="] = 8] = "=";
    HtmlTokenType[HtmlTokenType["qm"] = 9] = "qm";
    HtmlTokenType[HtmlTokenType["identity"] = 10] = "identity";
    HtmlTokenType[HtmlTokenType["stringLiteral"] = 11] = "stringLiteral";
    HtmlTokenType[HtmlTokenType["any"] = 12] = "any";
    HtmlTokenType[HtmlTokenType["space"] = 13] = "space";
    HtmlTokenType[HtmlTokenType["comment"] = 14] = "comment";
})(HtmlTokenType = exports.HtmlTokenType || (exports.HtmlTokenType = {}));
exports.TokenType = HtmlTokenType;
const lexer = (la, emitter) => {
    let isLastCharUnknown = false;
    function emitUnknow() {
        if (isLastCharUnknown) {
            emitter.emit();
            isLastCharUnknown = false;
        }
    }
    const m = new LexerMemebers(la, emitter, emitUnknow);
    while (true) {
        let char = la.la();
        if (char == null) {
            emitUnknow();
            emitter.end();
            return;
        }
        if (m.isComment()) {
            la.startChunk(HtmlTokenType.comment);
            m.consumeComment();
            emitter.emit();
            continue;
        }
        else if (m.isSwigComment()) {
            la.startChunk(HtmlTokenType.comment);
            m.swigComment();
            emitter.emit();
            continue;
        }
        switch (char) {
            case '>':
            case '(':
            case ')':
            case '[':
            case ']':
            case '=':
                emitUnknow();
                la.startChunk(HtmlTokenType[char]);
                la.advance();
                emitter.emit();
                continue;
            case '"':
            case '\'':
                emitUnknow();
                la.startChunk(HtmlTokenType.qm);
                la.advance();
                emitter.emit();
                continue;
            default:
        }
        if (char === '<' && m.isIdStart(2)) {
            m.openTagStart();
        }
        else if (la.isNext('<', '/')) {
            m.closeTagStart();
        }
        else if (la.isNext('/', '>')) {
            emitUnknow();
            la.startChunk(HtmlTokenType['/>']);
            la.advance(2);
            emitter.emit();
        }
        else if (m.isIdStart()) {
            emitUnknow();
            la.startChunk(HtmlTokenType.identity);
            do {
                la.advance();
                char = la.la();
            } while (m.isIdStart());
            emitter.emit();
        }
        else if (m.isWhitespace()) {
            emitUnknow();
            la.startChunk(HtmlTokenType.space);
            do {
                la.advance();
            } while (m.isWhitespace());
            emitter.emit();
            // yield new Token(HtmlTokenType.space, this, start);
            continue;
        }
        else {
            if (!isLastCharUnknown) {
                la.startChunk(HtmlTokenType.any);
                isLastCharUnknown = true;
            }
            la.advance();
        }
    }
};
exports.lexer = lexer;
class LexerMemebers {
    constructor(la, emitter, emitUnknow) {
        this.la = la;
        this.emitter = emitter;
        this.emitUnknow = emitUnknow;
    }
    openTagStart() {
        this.emitUnknow();
        this.la.startChunk(HtmlTokenType['<']);
        this.la.advance();
        do {
            this.la.advance();
        } while (this.isIdStart());
        this.emitter.emit();
    }
    closeTagStart() {
        this.emitUnknow();
        this.la.startChunk(HtmlTokenType['</']);
        this.la.advance(2);
        while (this.la.la() !== '>') {
            this.la.advance();
        }
        this.emitter.emit();
    }
    isIdStart(laIdx = 1) {
        const char = this.la.la(laIdx);
        if (!char) {
            this.la.throwError('EOF');
            return;
        }
        return /[^<>()\[\]"'=`/]/.test(char) && /\S/.test(char);
    }
    isWhitespace() {
        const chr = this.la.la();
        return chr && /\s/.test(chr);
    }
    stringLit(quote) {
        this.emitUnknow();
        this.la.advance();
        this.la.startChunk(HtmlTokenType.stringLiteral);
        const positionInfo = this.la.getCurrentPosInfo();
        while (this.la.la() !== quote) {
            if (this.la.la() == null) {
                console.log('endless string literal begin at', positionInfo);
                this.la.throwError();
            }
            // console.log(':', this.la());
            if (this.la.la() === '\\') {
                this.la.advance();
            }
            this.la.advance();
        }
        this.emitter.emit();
        // const tk = new Token(HtmlTokenType.stringLiteral, this, start);
        this.la.advance();
        // return tk;
    }
    isComment() {
        return this.la.isNext('<', '!', '-', '-');
    }
    consumeComment() {
        this.la.advance(4);
        while (!this.la.isNext('-', '-', '>')) {
            if (this.la.la() == null)
                throw new Error('Comment is not closed, ' + this.la.getCurrentPosInfo());
            this.la.advance();
        }
        this.la.advance(3);
        return true;
    }
    isSwigComment() {
        return this.la.isNext('{', '#');
    }
    swigComment() {
        this.la.advance(2);
        while (!this.la.isNext('#', '}')) {
            this.la.advance();
        }
        this.la.advance(2);
    }
}
var TagKind;
(function (TagKind) {
    TagKind[TagKind["open"] = 0] = "open";
    TagKind[TagKind["close"] = 1] = "close";
})(TagKind = exports.TagKind || (exports.TagKind = {}));
const grammar = (tokenLa) => {
    const ast = [];
    const allTags = [];
    const comments = [];
    while (tokenLa.la() != null) {
        if (tokenLa.la().type === HtmlTokenType['<']) {
            const tagAst = tag(tokenLa);
            ast.push(tagAst);
            allTags.push(tagAst);
        }
        else if (tokenLa.la().type === HtmlTokenType['</']) {
            const closingTagAst = closingTag(tokenLa);
            allTags.push(closingTagAst);
        }
        else if (tokenLa.la().type === HtmlTokenType.comment) {
            comments.push(tokenLa.advance());
        }
        else {
            tokenLa.advance();
        }
    }
    return {
        tags: ast,
        comments,
        allTags
    };
};
function tag(tokenLa) {
    const first = tokenLa.advance();
    const name = first.text.substring(1);
    const attrs = attributes(tokenLa);
    if (tokenLa.la() == null) {
        this.throwError('EOF');
    }
    const last = tokenLa.advance(); // >
    return { kind: TagKind.open, name, attrs, start: first.pos, end: last.end, selfClosed: last.type === HtmlTokenType['/>'] };
}
function closingTag(tokenLa) {
    const first = tokenLa.advance();
    const name = first.text.slice(2);
    const rightAngular = tokenLa.advance();
    return { kind: TagKind.close, name, start: first.pos, end: rightAngular.end };
}
function isSameType(token, type) {
    return token.type === type;
}
function attributes(tokenLa) {
    const attrs = {};
    while (tokenLa.la() && !tokenLa.isNextWith([HtmlTokenType['>']], isSameType) &&
        !tokenLa.isNextWith([HtmlTokenType['/>']], isSameType)) {
        if (isNgAttrName(tokenLa)) {
            const key = ngAttrName(tokenLa);
            attrs[key] = { isNg: true, value: attrValue(tokenLa) };
        }
        else if (tokenLa.la().type === HtmlTokenType.identity) {
            const key = attrName(tokenLa);
            attrs[key] = { isNg: false, value: attrValue(tokenLa) };
        }
        else if (tokenLa.isNextWith([HtmlTokenType.space], isSameType)) {
            tokenLa.advance();
        }
        else {
            const token = tokenLa.advance();
            throw new Error(`Unexpect token type: ${HtmlTokenType[token.type]}, text: ${token.text} at line: ${token.line}, column: ${token.col}`);
        }
    }
    return attrs;
}
function isNgAttrName(tokenLa) {
    if (tokenLa.la() == null)
        tokenLa.throwError('End of file');
    const type = tokenLa.la().type;
    return type === HtmlTokenType['['] || type === HtmlTokenType['('];
}
function ngAttrName(tokenLa) {
    if (tokenLa.la() == null)
        tokenLa.throwError('End of file');
    const kind = tokenLa.la().type === HtmlTokenType['['] ? HtmlTokenType[']'] : HtmlTokenType[')'];
    let name;
    tokenLa.advance();
    if (isNgAttrName(tokenLa))
        name = ngAttrName(tokenLa);
    else
        name = attrName(tokenLa);
    if (tokenLa.la().type !== kind)
        tokenLa.throwError(tokenLa.la().text);
    tokenLa.advance();
    return name;
}
function attrName(tokenLa) {
    return tokenLa.advance().text;
}
function attrValue(tokenLa) {
    if (tokenLa.la() && tokenLa.la().type === HtmlTokenType['=']) {
        // let {text, start, end} = this.advance(2);
        // return {text, start, end};
        tokenLa.advance();
        let start = tokenLa.la() && tokenLa.la().pos;
        let end = start;
        if (tokenLa.la() && tokenLa.la().type === HtmlTokenType.qm) {
            const quoteMark = tokenLa.advance().text;
            start = tokenLa.la() && tokenLa.la().pos;
            while (tokenLa.la() && tokenLa.la().text !== quoteMark) {
                tokenLa.advance();
            }
            if (!tokenLa.isNextWith([quoteMark], (token, text) => token.text === text)) {
                throw new Error('Unexpect ' + tokenLa.la());
            }
            end = tokenLa.advance().pos;
            // console.log('value:', this.text.slice(start, end));
            return {
                start: start,
                end,
                text: '(-,-)'
            };
        }
        else {
            let end = start;
            while (tokenLa.la() && !tokenLa.isNextWith([HtmlTokenType.space], isSameType) &&
                !tokenLa.isNextWith([HtmlTokenType['>']], isSameType)) {
                end = tokenLa.advance().end;
            }
            if (tokenLa.la() == null) {
                tokenLa.throwError('end of file');
            }
            return {
                start: start,
                end,
                text: '(-,-)'
            };
        }
    }
    else {
        return;
    }
}
const parseFunc = LLn_parser_1.createStringParser('DrcpHtmlParser', exports.lexer, grammar);
function parseHtml(input) {
    const result = parseFunc(input);
    for (const tag of result.tags) {
        if (tag.attrs) {
            for (const attrName in tag.attrs) {
                if (Object.prototype.hasOwnProperty.call(tag.attrs, attrName)) {
                    const value = tag.attrs[attrName];
                    if (value.value) {
                        const { start, end } = value.value;
                        value.value.text = input.slice(start, end);
                    }
                }
            }
        }
    }
    return result;
}
exports.default = parseHtml;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctaHRtbC1wYXJzZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJuZy1odG1sLXBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxnSkFBZ0o7QUFDaEo7O0dBRUc7QUFDSCxvRkFBb0Y7QUFDcEYsK0RBQW9HO0FBRXBHLElBQVksYUFpQlg7QUFqQkQsV0FBWSxhQUFhO0lBQ3ZCLFlBQVk7SUFDWiwyQ0FBRyxDQUFBO0lBQ0gsMkNBQUcsQ0FBQTtJQUNILDZDQUFJLENBQUE7SUFDSiwyQ0FBRyxDQUFBO0lBQ0gsMkNBQUcsQ0FBQTtJQUNILDJDQUFHLENBQUE7SUFDSCwyQ0FBRyxDQUFBO0lBQ0gsNkNBQUksQ0FBQTtJQUNKLDJDQUFHLENBQUE7SUFDSCw2Q0FBRSxDQUFBO0lBQ0YsMERBQVEsQ0FBQTtJQUNSLG9FQUFhLENBQUE7SUFDYixnREFBRyxDQUFBO0lBQ0gsb0RBQUssQ0FBQTtJQUNMLHdEQUFPLENBQUE7QUFDVCxDQUFDLEVBakJXLGFBQWEsR0FBYixxQkFBYSxLQUFiLHFCQUFhLFFBaUJ4QjtBQTRLd0Isa0NBQVM7QUExSzNCLE1BQU0sS0FBSyxHQUFpQyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNqRSxJQUFJLGlCQUFpQixHQUFHLEtBQUssQ0FBQztJQUU5QixTQUFTLFVBQVU7UUFDakIsSUFBSSxpQkFBaUIsRUFBRTtZQUNyQixPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDZixpQkFBaUIsR0FBRyxLQUFLLENBQUM7U0FDM0I7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQUcsSUFBSSxhQUFhLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNyRCxPQUFPLElBQUksRUFBRTtRQUNYLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNuQixJQUFJLElBQUksSUFBSSxJQUFJLEVBQUU7WUFDaEIsVUFBVSxFQUFFLENBQUM7WUFD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Q0FBaUMsZ0JBQWdCLEVBQUUsYUFBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBRXZHLFNBQXdCLFNBQVMsQ0FBQyxLQUFhO0lBQzdDLE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNoQyxLQUFLLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUU7UUFDN0IsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFO1lBQ2IsS0FBSyxNQUFNLFFBQVEsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFO2dCQUNoQyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxFQUFFO29CQUM3RCxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUNsQyxJQUFJLEtBQUssQ0FBQyxLQUFLLEVBQUU7d0JBQ2YsTUFBTSxFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO3dCQUNqQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztxQkFDNUM7aUJBQ0Y7YUFDRjtTQUNGO0tBQ0Y7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBaEJELDRCQWdCQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlICBtYXgtY2xhc3Nlcy1wZXItZmlsZSwgbWF4LWxlbiwgbm8tY29uc29sZSwganNkb2MvY2hlY2stYWxpZ25tZW50LCBqc2RvYy9jaGVjay1pbmRlbnRhdGlvbiwganNkb2MvbmV3bGluZS1hZnRlci1kZXNjcmlwdGlvbiAqL1xuLyoqXG4gKiBUT0RPOiBTdXBwb3J0IHBhcnNpbmcgZmlsZSB3aXRoIDxzY3JpcHQ+PC9zY3JpcHQ+IHRhZyBjb250YWlucyBzcGVjaWFsIEpTIGNoYXJhY3RlciBsaWtlIFwiPFwiIGFuZCBcIj5cIlxuICovXG4vLyBpbXBvcnQge1Rva2VuLCBCYXNlUGFyc2VyLCBCYXNlTGV4ZXJ9IGZyb20gJ0B3ZmgvcGxpbmsvd2ZoL2Rpc3QvYmFzZS1MTG4tcGFyc2VyJztcbmltcG9ydCB7TGV4ZXIsIEdyYW1tYXIsIExvb2tBaGVhZCwgVG9rZW4sIGNyZWF0ZVN0cmluZ1BhcnNlcn0gZnJvbSAnQHdmaC9wbGluay93ZmgvZGlzdC9MTG4tcGFyc2VyJztcblxuZXhwb3J0IGVudW0gSHRtbFRva2VuVHlwZSB7XG4gIC8vIGNvbW1lbnRzLFxuICAnPCcsXG4gICc+JyxcbiAgJy8+JyxcbiAgJygnLFxuICAnKScsXG4gICdbJyxcbiAgJ10nLFxuICAnPC8nLFxuICAnPScsXG4gIHFtLCAvLyBxdW90YXRpb24gbWFya1xuICBpZGVudGl0eSxcbiAgc3RyaW5nTGl0ZXJhbCxcbiAgYW55LCAvLyAuKlxuICBzcGFjZSxcbiAgY29tbWVudFxufVxuXG5leHBvcnQgY29uc3QgbGV4ZXI6IExleGVyPHN0cmluZywgSHRtbFRva2VuVHlwZT4gPSAobGEsIGVtaXR0ZXIpID0+IHtcbiAgbGV0IGlzTGFzdENoYXJVbmtub3duID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gZW1pdFVua25vdygpIHtcbiAgICBpZiAoaXNMYXN0Q2hhclVua25vd24pIHtcbiAgICAgIGVtaXR0ZXIuZW1pdCgpO1xuICAgICAgaXNMYXN0Q2hhclVua25vd24gPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBtID0gbmV3IExleGVyTWVtZWJlcnMobGEsIGVtaXR0ZXIsIGVtaXRVbmtub3cpO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGxldCBjaGFyID0gbGEubGEoKTtcbiAgICBpZiAoY2hhciA9PSBudWxsKSB7XG4gICAgICBlbWl0VW5rbm93KCk7XG4gICAgICBlbWl0dGVyLmVuZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAobS5pc0NvbW1lbnQoKSkge1xuICAgICAgbGEuc3RhcnRDaHVuayhIdG1sVG9rZW5UeXBlLmNvbW1lbnQpO1xuICAgICAgbS5jb25zdW1lQ29tbWVudCgpO1xuICAgICAgZW1pdHRlci5lbWl0KCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2UgaWYgKG0uaXNTd2lnQ29tbWVudCgpKSB7XG4gICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGUuY29tbWVudCk7XG4gICAgICBtLnN3aWdDb21tZW50KCk7XG4gICAgICBlbWl0dGVyLmVtaXQoKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBzd2l0Y2ggKGNoYXIpIHtcbiAgICAgIGNhc2UgJz4nOlxuICAgICAgY2FzZSAnKCc6XG4gICAgICBjYXNlICcpJzpcbiAgICAgIGNhc2UgJ1snOlxuICAgICAgY2FzZSAnXSc6XG4gICAgICBjYXNlICc9JzpcbiAgICAgICAgZW1pdFVua25vdygpO1xuICAgICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGVbY2hhcl0pO1xuICAgICAgICBsYS5hZHZhbmNlKCk7XG4gICAgICAgIGVtaXR0ZXIuZW1pdCgpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIGNhc2UgJ1wiJzpcbiAgICAgIGNhc2UgJ1xcJyc6XG4gICAgICAgIGVtaXRVbmtub3coKTtcbiAgICAgICAgbGEuc3RhcnRDaHVuayhIdG1sVG9rZW5UeXBlLnFtKTtcbiAgICAgICAgbGEuYWR2YW5jZSgpO1xuICAgICAgICBlbWl0dGVyLmVtaXQoKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICBkZWZhdWx0OlxuICAgIH1cbiAgICBpZiAoY2hhciA9PT0gJzwnICYmIG0uaXNJZFN0YXJ0KDIpKSB7XG4gICAgICBtLm9wZW5UYWdTdGFydCgpO1xuICAgIH0gZWxzZSBpZiAobGEuaXNOZXh0KCc8JywgJy8nKSkge1xuICAgICAgbS5jbG9zZVRhZ1N0YXJ0KCk7XG4gICAgfSBlbHNlIGlmIChsYS5pc05leHQoJy8nLCAnPicpKSB7XG4gICAgICBlbWl0VW5rbm93KCk7XG4gICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGVbJy8+J10pO1xuICAgICAgbGEuYWR2YW5jZSgyKTtcbiAgICAgIGVtaXR0ZXIuZW1pdCgpO1xuICAgIH0gZWxzZSBpZiAobS5pc0lkU3RhcnQoKSkge1xuICAgICAgZW1pdFVua25vdygpO1xuICAgICAgbGEuc3RhcnRDaHVuayhIdG1sVG9rZW5UeXBlLmlkZW50aXR5KTtcbiAgICAgIGRvIHtcbiAgICAgICAgbGEuYWR2YW5jZSgpO1xuICAgICAgICBjaGFyID0gbGEubGEoKTtcbiAgICAgIH0gd2hpbGUgKG0uaXNJZFN0YXJ0KCkpO1xuICAgICAgZW1pdHRlci5lbWl0KCk7XG4gICAgfSBlbHNlIGlmIChtLmlzV2hpdGVzcGFjZSgpKSB7XG4gICAgICBlbWl0VW5rbm93KCk7XG4gICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGUuc3BhY2UpO1xuICAgICAgZG8ge1xuICAgICAgICBsYS5hZHZhbmNlKCk7XG4gICAgICB9IHdoaWxlIChtLmlzV2hpdGVzcGFjZSgpKTtcbiAgICAgIGVtaXR0ZXIuZW1pdCgpO1xuICAgICAgLy8geWllbGQgbmV3IFRva2VuKEh0bWxUb2tlblR5cGUuc3BhY2UsIHRoaXMsIHN0YXJ0KTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIWlzTGFzdENoYXJVbmtub3duKSB7XG4gICAgICAgIGxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZS5hbnkpO1xuICAgICAgICBpc0xhc3RDaGFyVW5rbm93biA9IHRydWU7XG4gICAgICB9XG4gICAgICBsYS5hZHZhbmNlKCk7XG4gICAgfVxuICB9XG59O1xuXG5jbGFzcyBMZXhlck1lbWViZXJzIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBsYTogUGFyYW1ldGVyczxMZXhlcjxzdHJpbmcsIEh0bWxUb2tlblR5cGU+PlswXSxcbiAgICBwcml2YXRlIGVtaXR0ZXI6IFBhcmFtZXRlcnM8TGV4ZXI8c3RyaW5nLCBIdG1sVG9rZW5UeXBlPj5bMV0sXG4gICAgcHJpdmF0ZSBlbWl0VW5rbm93OiAoKSA9PiB2b2lkKSB7XG4gIH1cblxuICBvcGVuVGFnU3RhcnQoKSB7XG4gICAgdGhpcy5lbWl0VW5rbm93KCk7XG4gICAgdGhpcy5sYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGVbJzwnXSk7XG4gICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgZG8ge1xuICAgICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgfSB3aGlsZSAodGhpcy5pc0lkU3RhcnQoKSk7XG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoKTtcbiAgfVxuICBjbG9zZVRhZ1N0YXJ0KCkge1xuICAgIHRoaXMuZW1pdFVua25vdygpO1xuICAgIHRoaXMubGEuc3RhcnRDaHVuayhIdG1sVG9rZW5UeXBlWyc8LyddKTtcbiAgICB0aGlzLmxhLmFkdmFuY2UoMik7XG4gICAgd2hpbGUgKHRoaXMubGEubGEoKSAhPT0gJz4nKSB7XG4gICAgICB0aGlzLmxhLmFkdmFuY2UoKTtcbiAgICB9XG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoKTtcbiAgfVxuICBpc0lkU3RhcnQobGFJZHggPSAxKSB7XG4gICAgY29uc3QgY2hhciA9IHRoaXMubGEubGEobGFJZHgpO1xuICAgIGlmICghY2hhcikge1xuICAgICAgdGhpcy5sYS50aHJvd0Vycm9yKCdFT0YnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIC9bXjw+KClcXFtcXF1cIic9YC9dLy50ZXN0KGNoYXIpICYmIC9cXFMvLnRlc3QoY2hhcik7XG4gIH1cbiAgaXNXaGl0ZXNwYWNlKCkge1xuICAgIGNvbnN0IGNociA9IHRoaXMubGEubGEoKTtcbiAgICByZXR1cm4gY2hyICYmIC9cXHMvLnRlc3QoY2hyKTtcbiAgfVxuXG4gIHN0cmluZ0xpdChxdW90ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5lbWl0VW5rbm93KCk7XG4gICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgdGhpcy5sYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGUuc3RyaW5nTGl0ZXJhbCk7XG4gICAgY29uc3QgcG9zaXRpb25JbmZvID0gdGhpcy5sYS5nZXRDdXJyZW50UG9zSW5mbygpO1xuICAgIHdoaWxlICh0aGlzLmxhLmxhKCkgIT09IHF1b3RlKSB7XG4gICAgICBpZiAodGhpcy5sYS5sYSgpID09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VuZGxlc3Mgc3RyaW5nIGxpdGVyYWwgYmVnaW4gYXQnLCBwb3NpdGlvbkluZm8pO1xuICAgICAgICB0aGlzLmxhLnRocm93RXJyb3IoKTtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKCc6JywgdGhpcy5sYSgpKTtcbiAgICAgIGlmICh0aGlzLmxhLmxhKCkgPT09ICdcXFxcJykge1xuICAgICAgICB0aGlzLmxhLmFkdmFuY2UoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubGEuYWR2YW5jZSgpO1xuICAgIH1cbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgpO1xuICAgIC8vIGNvbnN0IHRrID0gbmV3IFRva2VuKEh0bWxUb2tlblR5cGUuc3RyaW5nTGl0ZXJhbCwgdGhpcywgc3RhcnQpO1xuICAgIHRoaXMubGEuYWR2YW5jZSgpO1xuICAgIC8vIHJldHVybiB0aztcbiAgfVxuXG4gIGlzQ29tbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5sYS5pc05leHQoJzwnLCAnIScsICctJywgJy0nKTtcbiAgfVxuICBjb25zdW1lQ29tbWVudCgpIHtcbiAgICB0aGlzLmxhLmFkdmFuY2UoNCk7XG4gICAgd2hpbGUoIXRoaXMubGEuaXNOZXh0KCctJywgJy0nLCAnPicpKSB7XG4gICAgICBpZiAodGhpcy5sYS5sYSgpID09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tbWVudCBpcyBub3QgY2xvc2VkLCAnICsgdGhpcy5sYS5nZXRDdXJyZW50UG9zSW5mbygpKTtcbiAgICAgIHRoaXMubGEuYWR2YW5jZSgpO1xuICAgIH1cbiAgICB0aGlzLmxhLmFkdmFuY2UoMyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaXNTd2lnQ29tbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5sYS5pc05leHQoJ3snLCAnIycpO1xuICB9XG4gIHN3aWdDb21tZW50KCkge1xuICAgIHRoaXMubGEuYWR2YW5jZSgyKTtcbiAgICB3aGlsZSAoIXRoaXMubGEuaXNOZXh0KCcjJywgJ30nKSkge1xuICAgICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgfVxuICAgIHRoaXMubGEuYWR2YW5jZSgyKTtcbiAgfVxufVxuXG5leHBvcnQge0h0bWxUb2tlblR5cGUgYXMgVG9rZW5UeXBlfTtcblxuZXhwb3J0IGludGVyZmFjZSBQYXJzZUh0bWxSZXN1bHQge1xuICAvKiogQXJyYXkgb25seSBjb250YWlucyBvcGVubmluZyB0YWdzICovXG4gIHRhZ3M6IE9wZW5UYWdBc3RbXTtcbiAgYWxsVGFnczogQmFzZVRhZ0FzdFtdO1xuICBjb21tZW50czogVG9rZW48SHRtbFRva2VuVHlwZT5bXTtcbn1cblxuZXhwb3J0IGVudW0gVGFnS2luZCB7XG4gIG9wZW4sIGNsb3NlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVRhZ0FzdCB7XG4gIGtpbmQ6IFRhZ0tpbmQ7XG4gIG5hbWU6IHN0cmluZztcbiAgc3RhcnQ6IG51bWJlcjtcbiAgZW5kOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlblRhZ0FzdCBleHRlbmRzIEJhc2VUYWdBc3Qge1xuICBhdHRycz86IHtba2V5OiBzdHJpbmddOiB7aXNOZzogYm9vbGVhbiwgdmFsdWU/OiBBdHRyaWJ1dGVWYWx1ZUFzdH19O1xuICBzZWxmQ2xvc2VkOiBib29sZWFuO1xuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBBdHRyaWJ1dGVWYWx1ZUFzdCB7XG4gIHRleHQ6IHN0cmluZzsgc3RhcnQ6IG51bWJlcjsgZW5kOiBudW1iZXI7XG59XG5cbmNvbnN0IGdyYW1tYXI6IEdyYW1tYXI8VG9rZW48SHRtbFRva2VuVHlwZT4sIFBhcnNlSHRtbFJlc3VsdD4gPSAodG9rZW5MYSkgPT4ge1xuICBjb25zdCBhc3Q6IE9wZW5UYWdBc3RbXSA9IFtdO1xuICBjb25zdCBhbGxUYWdzOiBCYXNlVGFnQXN0W10gPSBbXTtcbiAgY29uc3QgY29tbWVudHM6IFRva2VuPEh0bWxUb2tlblR5cGU+W10gPSBbXTtcbiAgd2hpbGUodG9rZW5MYS5sYSgpICE9IG51bGwpIHtcbiAgICBpZiAodG9rZW5MYS5sYSgpIS50eXBlID09PSBIdG1sVG9rZW5UeXBlWyc8J10pIHtcbiAgICAgIGNvbnN0IHRhZ0FzdCA9IHRhZyh0b2tlbkxhKTtcbiAgICAgIGFzdC5wdXNoKHRhZ0FzdCk7XG4gICAgICBhbGxUYWdzLnB1c2godGFnQXN0KTtcbiAgICB9IGVsc2UgaWYgKHRva2VuTGEubGEoKSEudHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnPC8nXSkge1xuICAgICAgY29uc3QgY2xvc2luZ1RhZ0FzdCA9IGNsb3NpbmdUYWcodG9rZW5MYSk7XG4gICAgICBhbGxUYWdzLnB1c2goY2xvc2luZ1RhZ0FzdCk7XG4gICAgfSBlbHNlIGlmICh0b2tlbkxhLmxhKCkhLnR5cGUgPT09IEh0bWxUb2tlblR5cGUuY29tbWVudCApIHtcbiAgICAgIGNvbW1lbnRzLnB1c2godG9rZW5MYS5hZHZhbmNlKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICB0YWdzOiBhc3QsXG4gICAgY29tbWVudHMsXG4gICAgYWxsVGFnc1xuICB9O1xufTtcblxuZnVuY3Rpb24gdGFnKHRva2VuTGE6IExvb2tBaGVhZDxUb2tlbjxIdG1sVG9rZW5UeXBlPj4pOiBPcGVuVGFnQXN0IHtcbiAgY29uc3QgZmlyc3QgPSB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgY29uc3QgbmFtZSA9IGZpcnN0LnRleHQuc3Vic3RyaW5nKDEpO1xuICBjb25zdCBhdHRycyA9IGF0dHJpYnV0ZXModG9rZW5MYSk7XG4gIGlmICh0b2tlbkxhLmxhKCkgPT1udWxsKSB7XG4gICAgdGhpcy50aHJvd0Vycm9yKCdFT0YnKTtcbiAgfVxuICBjb25zdCBsYXN0ID0gdG9rZW5MYS5hZHZhbmNlKCk7IC8vID5cbiAgcmV0dXJuIHtraW5kOiBUYWdLaW5kLm9wZW4sIG5hbWUsIGF0dHJzLCBzdGFydDogZmlyc3QucG9zLCBlbmQ6IGxhc3QhLmVuZCwgc2VsZkNsb3NlZDogbGFzdC50eXBlID09PSBIdG1sVG9rZW5UeXBlWycvPiddfTtcbn1cblxuZnVuY3Rpb24gY2xvc2luZ1RhZyh0b2tlbkxhOiBMb29rQWhlYWQ8VG9rZW48SHRtbFRva2VuVHlwZT4+KTogQmFzZVRhZ0FzdCB7XG4gIGNvbnN0IGZpcnN0ID0gdG9rZW5MYS5hZHZhbmNlKCk7XG4gIGNvbnN0IG5hbWUgPSBmaXJzdC50ZXh0LnNsaWNlKDIpO1xuICBjb25zdCByaWdodEFuZ3VsYXIgPSB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgcmV0dXJuIHtraW5kOiBUYWdLaW5kLmNsb3NlLCBuYW1lLCBzdGFydDogZmlyc3QucG9zLCBlbmQ6IHJpZ2h0QW5ndWxhci5lbmR9O1xufVxuXG5mdW5jdGlvbiBpc1NhbWVUeXBlKHRva2VuOiBUb2tlbjxIdG1sVG9rZW5UeXBlPiwgdHlwZTogSHRtbFRva2VuVHlwZSk6IGJvb2xlYW4ge1xuICByZXR1cm4gdG9rZW4udHlwZSA9PT0gdHlwZTtcbn1cblxuZnVuY3Rpb24gYXR0cmlidXRlcyh0aGlzOiB2b2lkLCB0b2tlbkxhOiBMb29rQWhlYWQ8VG9rZW48SHRtbFRva2VuVHlwZT4+KToge1trZXk6IHN0cmluZ106IHtpc05nOiBib29sZWFuLCB2YWx1ZTogQXR0cmlidXRlVmFsdWVBc3QgfCB1bmRlZmluZWR9fSB7XG4gIGNvbnN0IGF0dHJzOiB7W2tleTogc3RyaW5nXToge2lzTmc6IGJvb2xlYW4sIHZhbHVlOiBBdHRyaWJ1dGVWYWx1ZUFzdCB8IHVuZGVmaW5lZH19ID0ge307XG4gIHdoaWxlICh0b2tlbkxhLmxhKCkgJiYgIXRva2VuTGEuaXNOZXh0V2l0aChbSHRtbFRva2VuVHlwZVsnPiddXSwgaXNTYW1lVHlwZSkgJiZcbiAgICAhdG9rZW5MYS5pc05leHRXaXRoKFtIdG1sVG9rZW5UeXBlWycvPiddXSwgaXNTYW1lVHlwZSkpIHtcbiAgICBpZiAoaXNOZ0F0dHJOYW1lKHRva2VuTGEpKSB7XG4gICAgICBjb25zdCBrZXkgPSBuZ0F0dHJOYW1lKHRva2VuTGEpO1xuICAgICAgYXR0cnNba2V5XSA9IHtpc05nOiB0cnVlLCB2YWx1ZTogYXR0clZhbHVlKHRva2VuTGEpfTtcbiAgICB9IGVsc2UgaWYgKHRva2VuTGEubGEoKSEudHlwZSA9PT0gSHRtbFRva2VuVHlwZS5pZGVudGl0eSkge1xuICAgICAgY29uc3Qga2V5ID0gYXR0ck5hbWUodG9rZW5MYSk7XG4gICAgICBhdHRyc1trZXldID0ge2lzTmc6IGZhbHNlLCB2YWx1ZTogYXR0clZhbHVlKHRva2VuTGEpfTtcbiAgICB9IGVsc2UgaWYgKHRva2VuTGEuaXNOZXh0V2l0aChbSHRtbFRva2VuVHlwZS5zcGFjZV0sIGlzU2FtZVR5cGUpKSB7XG4gICAgICB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdG9rZW4gPSB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3QgdG9rZW4gdHlwZTogJHtIdG1sVG9rZW5UeXBlW3Rva2VuLnR5cGVdfSwgdGV4dDogJHt0b2tlbi50ZXh0fSBhdCBsaW5lOiAke3Rva2VuLmxpbmV9LCBjb2x1bW46ICR7dG9rZW4uY29sfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYXR0cnM7XG59XG5mdW5jdGlvbiBpc05nQXR0ck5hbWUodGhpczogdm9pZCwgdG9rZW5MYTogTG9va0FoZWFkPFRva2VuPEh0bWxUb2tlblR5cGU+Pikge1xuICBpZiAodG9rZW5MYS5sYSgpID09IG51bGwpXG4gICAgdG9rZW5MYS50aHJvd0Vycm9yKCdFbmQgb2YgZmlsZScpO1xuICBjb25zdCB0eXBlID0gdG9rZW5MYS5sYSgpIS50eXBlO1xuICByZXR1cm4gdHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnWyddIHx8IHR5cGUgPT09IEh0bWxUb2tlblR5cGVbJygnXTtcbn1cbmZ1bmN0aW9uIG5nQXR0ck5hbWUodGhpczogdm9pZCwgdG9rZW5MYTogTG9va0FoZWFkPFRva2VuPEh0bWxUb2tlblR5cGU+Pikge1xuICBpZiAodG9rZW5MYS5sYSgpID09IG51bGwpXG4gICAgdG9rZW5MYS50aHJvd0Vycm9yKCdFbmQgb2YgZmlsZScpO1xuICBjb25zdCBraW5kID0gdG9rZW5MYS5sYSgpIS50eXBlID09PSBIdG1sVG9rZW5UeXBlWydbJ10gPyBIdG1sVG9rZW5UeXBlWyddJ10gOiBIdG1sVG9rZW5UeXBlWycpJ107XG4gIGxldCBuYW1lOiBzdHJpbmc7XG4gIHRva2VuTGEuYWR2YW5jZSgpO1xuICBpZiAoaXNOZ0F0dHJOYW1lKHRva2VuTGEpKVxuICAgIG5hbWUgPSBuZ0F0dHJOYW1lKHRva2VuTGEpO1xuICBlbHNlXG4gICAgbmFtZSA9IGF0dHJOYW1lKHRva2VuTGEpO1xuICBpZiAodG9rZW5MYS5sYSgpIS50eXBlICE9PSBraW5kKVxuICAgIHRva2VuTGEudGhyb3dFcnJvcih0b2tlbkxhLmxhKCkhLnRleHQpO1xuICB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgcmV0dXJuIG5hbWU7XG59XG5mdW5jdGlvbiBhdHRyTmFtZSh0b2tlbkxhOiBMb29rQWhlYWQ8VG9rZW48SHRtbFRva2VuVHlwZT4+KSB7XG4gIHJldHVybiB0b2tlbkxhLmFkdmFuY2UoKS50ZXh0O1xufVxuZnVuY3Rpb24gYXR0clZhbHVlKHRoaXM6IHZvaWQsIHRva2VuTGE6IExvb2tBaGVhZDxUb2tlbjxIdG1sVG9rZW5UeXBlPj4pOiBBdHRyaWJ1dGVWYWx1ZUFzdCB8IHVuZGVmaW5lZCB7XG4gIGlmICh0b2tlbkxhLmxhKCkgJiYgdG9rZW5MYS5sYSgpIS50eXBlID09PSBIdG1sVG9rZW5UeXBlWyc9J10pIHtcbiAgICAvLyBsZXQge3RleHQsIHN0YXJ0LCBlbmR9ID0gdGhpcy5hZHZhbmNlKDIpO1xuICAgIC8vIHJldHVybiB7dGV4dCwgc3RhcnQsIGVuZH07XG4gICAgdG9rZW5MYS5hZHZhbmNlKCk7XG4gICAgbGV0IHN0YXJ0ID0gdG9rZW5MYS5sYSgpICYmIHRva2VuTGEubGEoKSEucG9zO1xuICAgIGxldCBlbmQgPSBzdGFydCE7XG4gICAgaWYgKHRva2VuTGEubGEoKSAmJiB0b2tlbkxhLmxhKCkhLnR5cGUgPT09IEh0bWxUb2tlblR5cGUucW0pIHtcbiAgICAgIGNvbnN0IHF1b3RlTWFyayA9IHRva2VuTGEuYWR2YW5jZSgpIS50ZXh0O1xuICAgICAgc3RhcnQgPSB0b2tlbkxhLmxhKCkgJiYgdG9rZW5MYS5sYSgpIS5wb3M7XG4gICAgICB3aGlsZSAodG9rZW5MYS5sYSgpICYmIHRva2VuTGEubGEoKSEudGV4dCAhPT0gcXVvdGVNYXJrKSB7XG4gICAgICAgIHRva2VuTGEuYWR2YW5jZSgpO1xuICAgICAgfVxuICAgICAgaWYgKCF0b2tlbkxhLmlzTmV4dFdpdGgoW3F1b3RlTWFya10sICh0b2tlbiwgdGV4dCkgPT4gdG9rZW4udGV4dCA9PT0gdGV4dCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdCAnICsgdG9rZW5MYS5sYSgpKTtcbiAgICAgIH1cbiAgICAgIGVuZCA9IHRva2VuTGEuYWR2YW5jZSgpLnBvcztcbiAgICAgIC8vIGNvbnNvbGUubG9nKCd2YWx1ZTonLCB0aGlzLnRleHQuc2xpY2Uoc3RhcnQsIGVuZCkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhcnQ6IHN0YXJ0ISxcbiAgICAgICAgZW5kLFxuICAgICAgICB0ZXh0OiAnKC0sLSknXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZW5kID0gc3RhcnQhO1xuICAgICAgd2hpbGUgKHRva2VuTGEubGEoKSAmJiAhdG9rZW5MYS5pc05leHRXaXRoKFtIdG1sVG9rZW5UeXBlLnNwYWNlXSwgaXNTYW1lVHlwZSkgJiZcbiAgICAgICAgIXRva2VuTGEuaXNOZXh0V2l0aChbSHRtbFRva2VuVHlwZVsnPiddXSwgaXNTYW1lVHlwZSkpIHtcbiAgICAgICAgICBlbmQgPSB0b2tlbkxhLmFkdmFuY2UoKS5lbmQ7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW5MYS5sYSgpID09IG51bGwpIHtcbiAgICAgICAgdG9rZW5MYS50aHJvd0Vycm9yKCdlbmQgb2YgZmlsZScpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhcnQ6IHN0YXJ0ISxcbiAgICAgICAgZW5kLFxuICAgICAgICB0ZXh0OiAnKC0sLSknXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm47XG4gIH1cbn1cblxuY29uc3QgcGFyc2VGdW5jID0gY3JlYXRlU3RyaW5nUGFyc2VyPEh0bWxUb2tlblR5cGUsIFBhcnNlSHRtbFJlc3VsdD4oJ0RyY3BIdG1sUGFyc2VyJywgbGV4ZXIsIGdyYW1tYXIpO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwYXJzZUh0bWwoaW5wdXQ6IHN0cmluZykge1xuICBjb25zdCByZXN1bHQgPSBwYXJzZUZ1bmMoaW5wdXQpO1xuICBmb3IgKGNvbnN0IHRhZyBvZiByZXN1bHQudGFncykge1xuICAgIGlmICh0YWcuYXR0cnMpIHtcbiAgICAgIGZvciAoY29uc3QgYXR0ck5hbWUgaW4gdGFnLmF0dHJzKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGFnLmF0dHJzLCBhdHRyTmFtZSkpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRhZy5hdHRyc1thdHRyTmFtZV07XG4gICAgICAgICAgaWYgKHZhbHVlLnZhbHVlKSB7XG4gICAgICAgICAgICBjb25zdCB7c3RhcnQsIGVuZH0gPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlLnRleHQgPSBpbnB1dC5zbGljZShzdGFydCwgZW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbiJdfQ==
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TagKind = exports.TokenType = exports.lexer = exports.HtmlTokenType = void 0;
/* eslint-disable  max-classes-per-file, max-len, no-console, jsdoc/check-alignment, jsdoc/check-indentation, jsdoc/newline-after-description */
/**
 * TODO: Support parsing file with <script></script> tag contains special JS character like "<" and ">"
 */
// import {Token, BaseParser, BaseLexer} from '@wfh/plink/wfh/dist/base-LLn-parser';
const LLn_parser_1 = require("@wfh/plink/wfh/dist/LLn-parser");
var HtmlTokenType;
(function (HtmlTokenType) {
    // comments,
    HtmlTokenType[HtmlTokenType["<"] = 0] = "<";
    HtmlTokenType[HtmlTokenType[">"] = 1] = ">";
    HtmlTokenType[HtmlTokenType["/>"] = 2] = "/>";
    HtmlTokenType[HtmlTokenType["("] = 3] = "(";
    HtmlTokenType[HtmlTokenType[")"] = 4] = ")";
    HtmlTokenType[HtmlTokenType["["] = 5] = "[";
    HtmlTokenType[HtmlTokenType["]"] = 6] = "]";
    HtmlTokenType[HtmlTokenType["</"] = 7] = "</";
    HtmlTokenType[HtmlTokenType["="] = 8] = "=";
    HtmlTokenType[HtmlTokenType["qm"] = 9] = "qm";
    HtmlTokenType[HtmlTokenType["identity"] = 10] = "identity";
    HtmlTokenType[HtmlTokenType["stringLiteral"] = 11] = "stringLiteral";
    HtmlTokenType[HtmlTokenType["any"] = 12] = "any";
    HtmlTokenType[HtmlTokenType["space"] = 13] = "space";
    HtmlTokenType[HtmlTokenType["comment"] = 14] = "comment";
})(HtmlTokenType = exports.HtmlTokenType || (exports.HtmlTokenType = {}));
exports.TokenType = HtmlTokenType;
const lexer = (la, emitter) => {
    let isLastCharUnknown = false;
    function emitUnknow() {
        if (isLastCharUnknown) {
            emitter.emit();
            isLastCharUnknown = false;
        }
    }
    const m = new LexerMemebers(la, emitter, emitUnknow);
    while (true) {
        let char = la.la();
        if (char == null) {
            emitUnknow();
            emitter.end();
            return;
        }
        if (m.isComment()) {
            la.startChunk(HtmlTokenType.comment);
            m.consumeComment();
            emitter.emit();
            continue;
        }
        else if (m.isSwigComment()) {
            la.startChunk(HtmlTokenType.comment);
            m.swigComment();
            emitter.emit();
            continue;
        }
        switch (char) {
            case '>':
            case '(':
            case ')':
            case '[':
            case ']':
            case '=':
                emitUnknow();
                la.startChunk(HtmlTokenType[char]);
                la.advance();
                emitter.emit();
                continue;
            case '"':
            case '\'':
                emitUnknow();
                la.startChunk(HtmlTokenType.qm);
                la.advance();
                emitter.emit();
                continue;
            default:
        }
        if (char === '<' && m.isIdStart(2)) {
            m.openTagStart();
        }
        else if (la.isNext('<', '/')) {
            m.closeTagStart();
        }
        else if (la.isNext('/', '>')) {
            emitUnknow();
            la.startChunk(HtmlTokenType['/>']);
            la.advance(2);
            emitter.emit();
        }
        else if (m.isIdStart()) {
            emitUnknow();
            la.startChunk(HtmlTokenType.identity);
            do {
                la.advance();
                char = la.la();
            } while (m.isIdStart());
            emitter.emit();
        }
        else if (m.isWhitespace()) {
            emitUnknow();
            la.startChunk(HtmlTokenType.space);
            do {
                la.advance();
            } while (m.isWhitespace());
            emitter.emit();
            // yield new Token(HtmlTokenType.space, this, start);
            continue;
        }
        else {
            if (!isLastCharUnknown) {
                la.startChunk(HtmlTokenType.any);
                isLastCharUnknown = true;
            }
            la.advance();
        }
    }
};
exports.lexer = lexer;
class LexerMemebers {
    constructor(la, emitter, emitUnknow) {
        this.la = la;
        this.emitter = emitter;
        this.emitUnknow = emitUnknow;
    }
    openTagStart() {
        this.emitUnknow();
        this.la.startChunk(HtmlTokenType['<']);
        this.la.advance();
        do {
            this.la.advance();
        } while (this.isIdStart());
        this.emitter.emit();
    }
    closeTagStart() {
        this.emitUnknow();
        this.la.startChunk(HtmlTokenType['</']);
        this.la.advance(2);
        while (this.la.la() !== '>') {
            this.la.advance();
        }
        this.emitter.emit();
    }
    isIdStart(laIdx = 1) {
        const char = this.la.la(laIdx);
        if (!char) {
            this.la.throwError('EOF');
            return;
        }
        return /[^<>()\[\]"'=`/]/.test(char) && /\S/.test(char);
    }
    isWhitespace() {
        const chr = this.la.la();
        return chr && /\s/.test(chr);
    }
    stringLit(quote) {
        this.emitUnknow();
        this.la.advance();
        this.la.startChunk(HtmlTokenType.stringLiteral);
        const positionInfo = this.la.getCurrentPosInfo();
        while (this.la.la() !== quote) {
            if (this.la.la() == null) {
                console.log('endless string literal begin at', positionInfo);
                this.la.throwError();
            }
            // console.log(':', this.la());
            if (this.la.la() === '\\') {
                this.la.advance();
            }
            this.la.advance();
        }
        this.emitter.emit();
        // const tk = new Token(HtmlTokenType.stringLiteral, this, start);
        this.la.advance();
        // return tk;
    }
    isComment() {
        return this.la.isNext('<', '!', '-', '-');
    }
    consumeComment() {
        this.la.advance(4);
        while (!this.la.isNext('-', '-', '>')) {
            if (this.la.la() == null)
                throw new Error('Comment is not closed, ' + this.la.getCurrentPosInfo());
            this.la.advance();
        }
        this.la.advance(3);
        return true;
    }
    isSwigComment() {
        return this.la.isNext('{', '#');
    }
    swigComment() {
        this.la.advance(2);
        while (!this.la.isNext('#', '}')) {
            this.la.advance();
        }
        this.la.advance(2);
    }
}
var TagKind;
(function (TagKind) {
    TagKind[TagKind["open"] = 0] = "open";
    TagKind[TagKind["close"] = 1] = "close";
})(TagKind = exports.TagKind || (exports.TagKind = {}));
const grammar = (tokenLa) => {
    const ast = [];
    const allTags = [];
    const comments = [];
    while (tokenLa.la() != null) {
        if (tokenLa.la().type === HtmlTokenType['<']) {
            const tagAst = tag(tokenLa);
            ast.push(tagAst);
            allTags.push(tagAst);
        }
        else if (tokenLa.la().type === HtmlTokenType['</']) {
            const closingTagAst = closingTag(tokenLa);
            allTags.push(closingTagAst);
        }
        else if (tokenLa.la().type === HtmlTokenType.comment) {
            comments.push(tokenLa.advance());
        }
        else {
            tokenLa.advance();
        }
    }
    return {
        tags: ast,
        comments,
        allTags
    };
};
function tag(tokenLa) {
    const first = tokenLa.advance();
    const name = first.text.substring(1);
    const attrs = attributes(tokenLa);
    if (tokenLa.la() == null) {
        tokenLa.throwError('EOF');
    }
    const last = tokenLa.advance(); // >
    return { kind: TagKind.open, name, attrs, start: first.pos, end: last.end, selfClosed: last.type === HtmlTokenType['/>'] };
}
function closingTag(tokenLa) {
    const first = tokenLa.advance();
    const name = first.text.slice(2);
    const rightAngular = tokenLa.advance();
    return { kind: TagKind.close, name, start: first.pos, end: rightAngular.end };
}
function isSameType(token, type) {
    return token.type === type;
}
function attributes(tokenLa) {
    const attrs = {};
    while (tokenLa.la() && !tokenLa.isNextWith([HtmlTokenType['>']], isSameType) &&
        !tokenLa.isNextWith([HtmlTokenType['/>']], isSameType)) {
        if (isNgAttrName(tokenLa)) {
            const key = ngAttrName(tokenLa);
            attrs[key] = { isNg: true, value: attrValue(tokenLa) };
        }
        else if (tokenLa.la().type === HtmlTokenType.identity) {
            const key = attrName(tokenLa);
            attrs[key] = { isNg: false, value: attrValue(tokenLa) };
        }
        else if (tokenLa.isNextWith([HtmlTokenType.space], isSameType)) {
            tokenLa.advance();
        }
        else {
            const token = tokenLa.advance();
            throw new Error(`Unexpect token type: ${token.type ? HtmlTokenType[token.type] : 'Undefined'}, text: ${token.text} at line: ${token.line}, column: ${token.col}`);
        }
    }
    return attrs;
}
function isNgAttrName(tokenLa) {
    if (tokenLa.la() == null)
        tokenLa.throwError('End of file');
    const type = tokenLa.la().type;
    return type === HtmlTokenType['['] || type === HtmlTokenType['('];
}
function ngAttrName(tokenLa) {
    if (tokenLa.la() == null)
        tokenLa.throwError('End of file');
    const kind = tokenLa.la().type === HtmlTokenType['['] ? HtmlTokenType[']'] : HtmlTokenType[')'];
    let name;
    tokenLa.advance();
    if (isNgAttrName(tokenLa))
        name = ngAttrName(tokenLa);
    else
        name = attrName(tokenLa);
    if (tokenLa.la().type !== kind)
        tokenLa.throwError(tokenLa.la().text);
    tokenLa.advance();
    return name;
}
function attrName(tokenLa) {
    return tokenLa.advance().text;
}
function attrValue(tokenLa) {
    if (tokenLa.la() && tokenLa.la().type === HtmlTokenType['=']) {
        // let {text, start, end} = this.advance(2);
        // return {text, start, end};
        tokenLa.advance();
        let start = tokenLa.la() && tokenLa.la().pos;
        let end = start;
        if (tokenLa.la() && tokenLa.la().type === HtmlTokenType.qm) {
            const quoteMark = tokenLa.advance().text;
            start = tokenLa.la() && tokenLa.la().pos;
            while (tokenLa.la() && tokenLa.la().text !== quoteMark) {
                tokenLa.advance();
            }
            if (!tokenLa.isNextWith([quoteMark], (token, text) => token.text === text)) {
                throw new Error('Unexpect ' + tokenLa.la());
            }
            end = tokenLa.advance().pos;
            // console.log('value:', this.text.slice(start, end));
            return {
                start: start,
                end,
                text: '(-,-)'
            };
        }
        else {
            let end = start;
            while (tokenLa.la() && !tokenLa.isNextWith([HtmlTokenType.space], isSameType) &&
                !tokenLa.isNextWith([HtmlTokenType['>']], isSameType)) {
                end = tokenLa.advance().end;
            }
            if (tokenLa.la() == null) {
                tokenLa.throwError('end of file');
            }
            return {
                start: start,
                end,
                text: '(-,-)'
            };
        }
    }
    else {
        return;
    }
}
const parseFunc = LLn_parser_1.createStringParser('DrcpHtmlParser', exports.lexer, grammar);
function parseHtml(input) {
    const result = parseFunc(input);
    for (const tag of result.tags) {
        if (tag.attrs) {
            for (const attrName in tag.attrs) {
                if (Object.prototype.hasOwnProperty.call(tag.attrs, attrName)) {
                    const value = tag.attrs[attrName];
                    if (value.value) {
                        const { start, end } = value.value;
                        value.value.text = input.slice(start, end);
                    }
                }
            }
        }
    }
    return result;
}
exports.default = parseHtml;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctaHRtbC1wYXJzZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJuZy1odG1sLXBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxnSkFBZ0o7QUFDaEo7O0dBRUc7QUFDSCxvRkFBb0Y7QUFDcEYsK0RBQW9HO0FBRXBHLElBQVksYUFpQlg7QUFqQkQsV0FBWSxhQUFhO0lBQ3ZCLFlBQVk7SUFDWiwyQ0FBRyxDQUFBO0lBQ0gsMkNBQUcsQ0FBQTtJQUNILDZDQUFJLENBQUE7SUFDSiwyQ0FBRyxDQUFBO0lBQ0gsMkNBQUcsQ0FBQTtJQUNILDJDQUFHLENBQUE7SUFDSCwyQ0FBRyxDQUFBO0lBQ0gsNkNBQUksQ0FBQTtJQUNKLDJDQUFHLENBQUE7SUFDSCw2Q0FBRSxDQUFBO0lBQ0YsMERBQVEsQ0FBQTtJQUNSLG9FQUFhLENBQUE7SUFDYixnREFBRyxDQUFBO0lBQ0gsb0RBQUssQ0FBQTtJQUNMLHdEQUFPLENBQUE7QUFDVCxDQUFDLEVBakJXLGFBQWEsR0FBYixxQkFBYSxLQUFiLHFCQUFhLFFBaUJ4QjtBQTRLd0Isa0NBQVM7QUExSzNCLE1BQU0sS0FBSyxHQUFpQyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNqRSxJQUFJLGlCQUFpQixHQUFHLEtBQUssQ0FBQztJQUU5QixTQUFTLFVBQVU7UUFDakIsSUFBSSxpQkFBaUIsRUFBRTtZQUNyQixPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDZixpQkFBaUIsR0FBRyxLQUFLLENBQUM7U0FDM0I7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQUcsSUFBSSxhQUFhLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNyRCxPQUFPLElBQUksRUFBRTtRQUNYLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNuQixJQUFJLElBQUksSUFBSSxJQUFJLEVBQUU7WUFDaEIsVUFBVSxFQUFFLENBQUM7WUFD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Q0wsT0FBTztLQUNSO0FBQ0gsQ0FBQztBQUVELE1BQU0sU0FBUyxHQUFHLCtCQUFrQixDQUFpQyxnQkFBZ0IsRUFBRSxhQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFdkcsU0FBd0IsU0FBUyxDQUFDLEtBQWE7SUFDN0MsTUFBTSxNQUFNLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLEtBQUssTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksRUFBRTtRQUM3QixJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUU7WUFDYixLQUFLLE1BQU0sUUFBUSxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUU7Z0JBQ2hDLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEVBQUU7b0JBQzdELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQ2xDLElBQUksS0FBSyxDQUFDLEtBQUssRUFBRTt3QkFDZixNQUFNLEVBQUMsS0FBSyxFQUFFLEdBQUcsRUFBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7d0JBQ2pDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO3FCQUM1QztpQkFDRjthQUNGO1NBQ0Y7S0FDRjtJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFoQkQsNEJBZ0JDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgIG1heC1jbGFzc2VzLXBlci1maWxlLCBtYXgtbGVuLCBuby1jb25zb2xlLCBqc2RvYy9jaGVjay1hbGlnbm1lbnQsIGpzZG9jL2NoZWNrLWluZGVudGF0aW9uLCBqc2RvYy9uZXdsaW5lLWFmdGVyLWRlc2NyaXB0aW9uICovXG4vKipcbiAqIFRPRE86IFN1cHBvcnQgcGFyc2luZyBmaWxlIHdpdGggPHNjcmlwdD48L3NjcmlwdD4gdGFnIGNvbnRhaW5zIHNwZWNpYWwgSlMgY2hhcmFjdGVyIGxpa2UgXCI8XCIgYW5kIFwiPlwiXG4gKi9cbi8vIGltcG9ydCB7VG9rZW4sIEJhc2VQYXJzZXIsIEJhc2VMZXhlcn0gZnJvbSAnQHdmaC9wbGluay93ZmgvZGlzdC9iYXNlLUxMbi1wYXJzZXInO1xuaW1wb3J0IHtMZXhlciwgR3JhbW1hciwgTG9va0FoZWFkLCBUb2tlbiwgY3JlYXRlU3RyaW5nUGFyc2VyfSBmcm9tICdAd2ZoL3BsaW5rL3dmaC9kaXN0L0xMbi1wYXJzZXInO1xuXG5leHBvcnQgZW51bSBIdG1sVG9rZW5UeXBlIHtcbiAgLy8gY29tbWVudHMsXG4gICc8JyxcbiAgJz4nLFxuICAnLz4nLFxuICAnKCcsXG4gICcpJyxcbiAgJ1snLFxuICAnXScsXG4gICc8LycsXG4gICc9JyxcbiAgcW0sIC8vIHF1b3RhdGlvbiBtYXJrXG4gIGlkZW50aXR5LFxuICBzdHJpbmdMaXRlcmFsLFxuICBhbnksIC8vIC4qXG4gIHNwYWNlLFxuICBjb21tZW50XG59XG5cbmV4cG9ydCBjb25zdCBsZXhlcjogTGV4ZXI8c3RyaW5nLCBIdG1sVG9rZW5UeXBlPiA9IChsYSwgZW1pdHRlcikgPT4ge1xuICBsZXQgaXNMYXN0Q2hhclVua25vd24gPSBmYWxzZTtcblxuICBmdW5jdGlvbiBlbWl0VW5rbm93KCkge1xuICAgIGlmIChpc0xhc3RDaGFyVW5rbm93bikge1xuICAgICAgZW1pdHRlci5lbWl0KCk7XG4gICAgICBpc0xhc3RDaGFyVW5rbm93biA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG0gPSBuZXcgTGV4ZXJNZW1lYmVycyhsYSwgZW1pdHRlciwgZW1pdFVua25vdyk7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgbGV0IGNoYXIgPSBsYS5sYSgpO1xuICAgIGlmIChjaGFyID09IG51bGwpIHtcbiAgICAgIGVtaXRVbmtub3coKTtcbiAgICAgIGVtaXR0ZXIuZW5kKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChtLmlzQ29tbWVudCgpKSB7XG4gICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGUuY29tbWVudCk7XG4gICAgICBtLmNvbnN1bWVDb21tZW50KCk7XG4gICAgICBlbWl0dGVyLmVtaXQoKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSBpZiAobS5pc1N3aWdDb21tZW50KCkpIHtcbiAgICAgIGxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZS5jb21tZW50KTtcbiAgICAgIG0uc3dpZ0NvbW1lbnQoKTtcbiAgICAgIGVtaXR0ZXIuZW1pdCgpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHN3aXRjaCAoY2hhcikge1xuICAgICAgY2FzZSAnPic6XG4gICAgICBjYXNlICcoJzpcbiAgICAgIGNhc2UgJyknOlxuICAgICAgY2FzZSAnWyc6XG4gICAgICBjYXNlICddJzpcbiAgICAgIGNhc2UgJz0nOlxuICAgICAgICBlbWl0VW5rbm93KCk7XG4gICAgICAgIGxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZVtjaGFyXSk7XG4gICAgICAgIGxhLmFkdmFuY2UoKTtcbiAgICAgICAgZW1pdHRlci5lbWl0KCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgY2FzZSAnXCInOlxuICAgICAgY2FzZSAnXFwnJzpcbiAgICAgICAgZW1pdFVua25vdygpO1xuICAgICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGUucW0pO1xuICAgICAgICBsYS5hZHZhbmNlKCk7XG4gICAgICAgIGVtaXR0ZXIuZW1pdCgpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgfVxuICAgIGlmIChjaGFyID09PSAnPCcgJiYgbS5pc0lkU3RhcnQoMikpIHtcbiAgICAgIG0ub3BlblRhZ1N0YXJ0KCk7XG4gICAgfSBlbHNlIGlmIChsYS5pc05leHQoJzwnLCAnLycpKSB7XG4gICAgICBtLmNsb3NlVGFnU3RhcnQoKTtcbiAgICB9IGVsc2UgaWYgKGxhLmlzTmV4dCgnLycsICc+JykpIHtcbiAgICAgIGVtaXRVbmtub3coKTtcbiAgICAgIGxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZVsnLz4nXSk7XG4gICAgICBsYS5hZHZhbmNlKDIpO1xuICAgICAgZW1pdHRlci5lbWl0KCk7XG4gICAgfSBlbHNlIGlmIChtLmlzSWRTdGFydCgpKSB7XG4gICAgICBlbWl0VW5rbm93KCk7XG4gICAgICBsYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGUuaWRlbnRpdHkpO1xuICAgICAgZG8ge1xuICAgICAgICBsYS5hZHZhbmNlKCk7XG4gICAgICAgIGNoYXIgPSBsYS5sYSgpO1xuICAgICAgfSB3aGlsZSAobS5pc0lkU3RhcnQoKSk7XG4gICAgICBlbWl0dGVyLmVtaXQoKTtcbiAgICB9IGVsc2UgaWYgKG0uaXNXaGl0ZXNwYWNlKCkpIHtcbiAgICAgIGVtaXRVbmtub3coKTtcbiAgICAgIGxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZS5zcGFjZSk7XG4gICAgICBkbyB7XG4gICAgICAgIGxhLmFkdmFuY2UoKTtcbiAgICAgIH0gd2hpbGUgKG0uaXNXaGl0ZXNwYWNlKCkpO1xuICAgICAgZW1pdHRlci5lbWl0KCk7XG4gICAgICAvLyB5aWVsZCBuZXcgVG9rZW4oSHRtbFRva2VuVHlwZS5zcGFjZSwgdGhpcywgc3RhcnQpO1xuICAgICAgY29udGludWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghaXNMYXN0Q2hhclVua25vd24pIHtcbiAgICAgICAgbGEuc3RhcnRDaHVuayhIdG1sVG9rZW5UeXBlLmFueSk7XG4gICAgICAgIGlzTGFzdENoYXJVbmtub3duID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGxhLmFkdmFuY2UoKTtcbiAgICB9XG4gIH1cbn07XG5cbmNsYXNzIExleGVyTWVtZWJlcnMge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxhOiBQYXJhbWV0ZXJzPExleGVyPHN0cmluZywgSHRtbFRva2VuVHlwZT4+WzBdLFxuICAgIHByaXZhdGUgZW1pdHRlcjogUGFyYW1ldGVyczxMZXhlcjxzdHJpbmcsIEh0bWxUb2tlblR5cGU+PlsxXSxcbiAgICBwcml2YXRlIGVtaXRVbmtub3c6ICgpID0+IHZvaWQpIHtcbiAgfVxuXG4gIG9wZW5UYWdTdGFydCgpIHtcbiAgICB0aGlzLmVtaXRVbmtub3coKTtcbiAgICB0aGlzLmxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZVsnPCddKTtcbiAgICB0aGlzLmxhLmFkdmFuY2UoKTtcbiAgICBkbyB7XG4gICAgICB0aGlzLmxhLmFkdmFuY2UoKTtcbiAgICB9IHdoaWxlICh0aGlzLmlzSWRTdGFydCgpKTtcbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgpO1xuICB9XG4gIGNsb3NlVGFnU3RhcnQoKSB7XG4gICAgdGhpcy5lbWl0VW5rbm93KCk7XG4gICAgdGhpcy5sYS5zdGFydENodW5rKEh0bWxUb2tlblR5cGVbJzwvJ10pO1xuICAgIHRoaXMubGEuYWR2YW5jZSgyKTtcbiAgICB3aGlsZSAodGhpcy5sYS5sYSgpICE9PSAnPicpIHtcbiAgICAgIHRoaXMubGEuYWR2YW5jZSgpO1xuICAgIH1cbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgpO1xuICB9XG4gIGlzSWRTdGFydChsYUlkeCA9IDEpIHtcbiAgICBjb25zdCBjaGFyID0gdGhpcy5sYS5sYShsYUlkeCk7XG4gICAgaWYgKCFjaGFyKSB7XG4gICAgICB0aGlzLmxhLnRocm93RXJyb3IoJ0VPRicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gL1tePD4oKVxcW1xcXVwiJz1gL10vLnRlc3QoY2hhcikgJiYgL1xcUy8udGVzdChjaGFyKTtcbiAgfVxuICBpc1doaXRlc3BhY2UoKSB7XG4gICAgY29uc3QgY2hyID0gdGhpcy5sYS5sYSgpO1xuICAgIHJldHVybiBjaHIgJiYgL1xccy8udGVzdChjaHIpO1xuICB9XG5cbiAgc3RyaW5nTGl0KHF1b3RlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmVtaXRVbmtub3coKTtcbiAgICB0aGlzLmxhLmFkdmFuY2UoKTtcbiAgICB0aGlzLmxhLnN0YXJ0Q2h1bmsoSHRtbFRva2VuVHlwZS5zdHJpbmdMaXRlcmFsKTtcbiAgICBjb25zdCBwb3NpdGlvbkluZm8gPSB0aGlzLmxhLmdldEN1cnJlbnRQb3NJbmZvKCk7XG4gICAgd2hpbGUgKHRoaXMubGEubGEoKSAhPT0gcXVvdGUpIHtcbiAgICAgIGlmICh0aGlzLmxhLmxhKCkgPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZygnZW5kbGVzcyBzdHJpbmcgbGl0ZXJhbCBiZWdpbiBhdCcsIHBvc2l0aW9uSW5mbyk7XG4gICAgICAgIHRoaXMubGEudGhyb3dFcnJvcigpO1xuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2coJzonLCB0aGlzLmxhKCkpO1xuICAgICAgaWYgKHRoaXMubGEubGEoKSA9PT0gJ1xcXFwnKSB7XG4gICAgICAgIHRoaXMubGEuYWR2YW5jZSgpO1xuICAgICAgfVxuICAgICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgfVxuICAgIHRoaXMuZW1pdHRlci5lbWl0KCk7XG4gICAgLy8gY29uc3QgdGsgPSBuZXcgVG9rZW4oSHRtbFRva2VuVHlwZS5zdHJpbmdMaXRlcmFsLCB0aGlzLCBzdGFydCk7XG4gICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgLy8gcmV0dXJuIHRrO1xuICB9XG5cbiAgaXNDb21tZW50KCkge1xuICAgIHJldHVybiB0aGlzLmxhLmlzTmV4dCgnPCcsICchJywgJy0nLCAnLScpO1xuICB9XG4gIGNvbnN1bWVDb21tZW50KCkge1xuICAgIHRoaXMubGEuYWR2YW5jZSg0KTtcbiAgICB3aGlsZSAoIXRoaXMubGEuaXNOZXh0KCctJywgJy0nLCAnPicpKSB7XG4gICAgICBpZiAodGhpcy5sYS5sYSgpID09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tbWVudCBpcyBub3QgY2xvc2VkLCAnICsgdGhpcy5sYS5nZXRDdXJyZW50UG9zSW5mbygpKTtcbiAgICAgIHRoaXMubGEuYWR2YW5jZSgpO1xuICAgIH1cbiAgICB0aGlzLmxhLmFkdmFuY2UoMyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaXNTd2lnQ29tbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5sYS5pc05leHQoJ3snLCAnIycpO1xuICB9XG4gIHN3aWdDb21tZW50KCkge1xuICAgIHRoaXMubGEuYWR2YW5jZSgyKTtcbiAgICB3aGlsZSAoIXRoaXMubGEuaXNOZXh0KCcjJywgJ30nKSkge1xuICAgICAgdGhpcy5sYS5hZHZhbmNlKCk7XG4gICAgfVxuICAgIHRoaXMubGEuYWR2YW5jZSgyKTtcbiAgfVxufVxuXG5leHBvcnQge0h0bWxUb2tlblR5cGUgYXMgVG9rZW5UeXBlfTtcblxuZXhwb3J0IGludGVyZmFjZSBQYXJzZUh0bWxSZXN1bHQge1xuICAvKiogQXJyYXkgb25seSBjb250YWlucyBvcGVubmluZyB0YWdzICovXG4gIHRhZ3M6IE9wZW5UYWdBc3RbXTtcbiAgYWxsVGFnczogQmFzZVRhZ0FzdFtdO1xuICBjb21tZW50czogVG9rZW48SHRtbFRva2VuVHlwZT5bXTtcbn1cblxuZXhwb3J0IGVudW0gVGFnS2luZCB7XG4gIG9wZW4sIGNsb3NlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVRhZ0FzdCB7XG4gIGtpbmQ6IFRhZ0tpbmQ7XG4gIG5hbWU6IHN0cmluZztcbiAgc3RhcnQ6IG51bWJlcjtcbiAgZW5kOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlblRhZ0FzdCBleHRlbmRzIEJhc2VUYWdBc3Qge1xuICBhdHRycz86IHtba2V5OiBzdHJpbmddOiB7aXNOZzogYm9vbGVhbjsgdmFsdWU/OiBBdHRyaWJ1dGVWYWx1ZUFzdH19O1xuICBzZWxmQ2xvc2VkOiBib29sZWFuO1xuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBBdHRyaWJ1dGVWYWx1ZUFzdCB7XG4gIHRleHQ6IHN0cmluZzsgc3RhcnQ6IG51bWJlcjsgZW5kOiBudW1iZXI7XG59XG5cbmNvbnN0IGdyYW1tYXI6IEdyYW1tYXI8VG9rZW48SHRtbFRva2VuVHlwZT4sIFBhcnNlSHRtbFJlc3VsdD4gPSAodG9rZW5MYSkgPT4ge1xuICBjb25zdCBhc3Q6IE9wZW5UYWdBc3RbXSA9IFtdO1xuICBjb25zdCBhbGxUYWdzOiBCYXNlVGFnQXN0W10gPSBbXTtcbiAgY29uc3QgY29tbWVudHM6IFRva2VuPEh0bWxUb2tlblR5cGU+W10gPSBbXTtcbiAgd2hpbGUgKHRva2VuTGEubGEoKSAhPSBudWxsKSB7XG4gICAgaWYgKHRva2VuTGEubGEoKSEudHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnPCddKSB7XG4gICAgICBjb25zdCB0YWdBc3QgPSB0YWcodG9rZW5MYSk7XG4gICAgICBhc3QucHVzaCh0YWdBc3QpO1xuICAgICAgYWxsVGFncy5wdXNoKHRhZ0FzdCk7XG4gICAgfSBlbHNlIGlmICh0b2tlbkxhLmxhKCkhLnR5cGUgPT09IEh0bWxUb2tlblR5cGVbJzwvJ10pIHtcbiAgICAgIGNvbnN0IGNsb3NpbmdUYWdBc3QgPSBjbG9zaW5nVGFnKHRva2VuTGEpO1xuICAgICAgYWxsVGFncy5wdXNoKGNsb3NpbmdUYWdBc3QpO1xuICAgIH0gZWxzZSBpZiAodG9rZW5MYS5sYSgpIS50eXBlID09PSBIdG1sVG9rZW5UeXBlLmNvbW1lbnQgKSB7XG4gICAgICBjb21tZW50cy5wdXNoKHRva2VuTGEuYWR2YW5jZSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdG9rZW5MYS5hZHZhbmNlKCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgdGFnczogYXN0LFxuICAgIGNvbW1lbnRzLFxuICAgIGFsbFRhZ3NcbiAgfTtcbn07XG5cbmZ1bmN0aW9uIHRhZyh0b2tlbkxhOiBMb29rQWhlYWQ8VG9rZW48SHRtbFRva2VuVHlwZT4sIHN0cmluZz4pOiBPcGVuVGFnQXN0IHtcbiAgY29uc3QgZmlyc3QgPSB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgY29uc3QgbmFtZSA9IGZpcnN0LnRleHQuc3Vic3RyaW5nKDEpO1xuICBjb25zdCBhdHRycyA9IGF0dHJpYnV0ZXModG9rZW5MYSk7XG4gIGlmICh0b2tlbkxhLmxhKCkgPT0gbnVsbCkge1xuICAgIHRva2VuTGEudGhyb3dFcnJvcignRU9GJyk7XG4gIH1cbiAgY29uc3QgbGFzdCA9IHRva2VuTGEuYWR2YW5jZSgpOyAvLyA+XG4gIHJldHVybiB7a2luZDogVGFnS2luZC5vcGVuLCBuYW1lLCBhdHRycywgc3RhcnQ6IGZpcnN0LnBvcywgZW5kOiBsYXN0LmVuZCwgc2VsZkNsb3NlZDogbGFzdC50eXBlID09PSBIdG1sVG9rZW5UeXBlWycvPiddfTtcbn1cblxuZnVuY3Rpb24gY2xvc2luZ1RhZyh0b2tlbkxhOiBMb29rQWhlYWQ8VG9rZW48SHRtbFRva2VuVHlwZT4sIHN0cmluZz4pOiBCYXNlVGFnQXN0IHtcbiAgY29uc3QgZmlyc3QgPSB0b2tlbkxhLmFkdmFuY2UoKTtcbiAgY29uc3QgbmFtZSA9IGZpcnN0LnRleHQuc2xpY2UoMik7XG4gIGNvbnN0IHJpZ2h0QW5ndWxhciA9IHRva2VuTGEuYWR2YW5jZSgpO1xuICByZXR1cm4ge2tpbmQ6IFRhZ0tpbmQuY2xvc2UsIG5hbWUsIHN0YXJ0OiBmaXJzdC5wb3MsIGVuZDogcmlnaHRBbmd1bGFyLmVuZH07XG59XG5cbmZ1bmN0aW9uIGlzU2FtZVR5cGUodG9rZW46IFRva2VuPEh0bWxUb2tlblR5cGU+LCB0eXBlOiBIdG1sVG9rZW5UeXBlKTogYm9vbGVhbiB7XG4gIHJldHVybiB0b2tlbi50eXBlID09PSB0eXBlO1xufVxuXG5mdW5jdGlvbiBhdHRyaWJ1dGVzKHRoaXM6IHZvaWQsIHRva2VuTGE6IExvb2tBaGVhZDxUb2tlbjxIdG1sVG9rZW5UeXBlPiwgc3RyaW5nPik6IHtba2V5OiBzdHJpbmddOiB7aXNOZzogYm9vbGVhbjsgdmFsdWU6IEF0dHJpYnV0ZVZhbHVlQXN0IHwgdW5kZWZpbmVkfX0ge1xuICBjb25zdCBhdHRyczoge1trZXk6IHN0cmluZ106IHtpc05nOiBib29sZWFuOyB2YWx1ZTogQXR0cmlidXRlVmFsdWVBc3QgfCB1bmRlZmluZWR9fSA9IHt9O1xuICB3aGlsZSAodG9rZW5MYS5sYSgpICYmICF0b2tlbkxhLmlzTmV4dFdpdGgoW0h0bWxUb2tlblR5cGVbJz4nXV0sIGlzU2FtZVR5cGUpICYmXG4gICAgIXRva2VuTGEuaXNOZXh0V2l0aChbSHRtbFRva2VuVHlwZVsnLz4nXV0sIGlzU2FtZVR5cGUpKSB7XG4gICAgaWYgKGlzTmdBdHRyTmFtZSh0b2tlbkxhKSkge1xuICAgICAgY29uc3Qga2V5ID0gbmdBdHRyTmFtZSh0b2tlbkxhKTtcbiAgICAgIGF0dHJzW2tleV0gPSB7aXNOZzogdHJ1ZSwgdmFsdWU6IGF0dHJWYWx1ZSh0b2tlbkxhKX07XG4gICAgfSBlbHNlIGlmICh0b2tlbkxhLmxhKCkhLnR5cGUgPT09IEh0bWxUb2tlblR5cGUuaWRlbnRpdHkpIHtcbiAgICAgIGNvbnN0IGtleSA9IGF0dHJOYW1lKHRva2VuTGEpO1xuICAgICAgYXR0cnNba2V5XSA9IHtpc05nOiBmYWxzZSwgdmFsdWU6IGF0dHJWYWx1ZSh0b2tlbkxhKX07XG4gICAgfSBlbHNlIGlmICh0b2tlbkxhLmlzTmV4dFdpdGgoW0h0bWxUb2tlblR5cGUuc3BhY2VdLCBpc1NhbWVUeXBlKSkge1xuICAgICAgdG9rZW5MYS5hZHZhbmNlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5MYS5hZHZhbmNlKCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuZXhwZWN0IHRva2VuIHR5cGU6ICR7dG9rZW4udHlwZSA/IEh0bWxUb2tlblR5cGVbdG9rZW4udHlwZV0gOiAnVW5kZWZpbmVkJ30sIHRleHQ6ICR7dG9rZW4udGV4dH0gYXQgbGluZTogJHt0b2tlbi5saW5lfSwgY29sdW1uOiAke3Rva2VuLmNvbH1gKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGF0dHJzO1xufVxuZnVuY3Rpb24gaXNOZ0F0dHJOYW1lKHRoaXM6IHZvaWQsIHRva2VuTGE6IExvb2tBaGVhZDxUb2tlbjxIdG1sVG9rZW5UeXBlPiwgc3RyaW5nPikge1xuICBpZiAodG9rZW5MYS5sYSgpID09IG51bGwpXG4gICAgdG9rZW5MYS50aHJvd0Vycm9yKCdFbmQgb2YgZmlsZScpO1xuICBjb25zdCB0eXBlID0gdG9rZW5MYS5sYSgpIS50eXBlO1xuICByZXR1cm4gdHlwZSA9PT0gSHRtbFRva2VuVHlwZVsnWyddIHx8IHR5cGUgPT09IEh0bWxUb2tlblR5cGVbJygnXTtcbn1cbmZ1bmN0aW9uIG5nQXR0ck5hbWUodGhpczogdm9pZCwgdG9rZW5MYTogTG9va0FoZWFkPFRva2VuPEh0bWxUb2tlblR5cGU+LCBzdHJpbmc+KSB7XG4gIGlmICh0b2tlbkxhLmxhKCkgPT0gbnVsbClcbiAgICB0b2tlbkxhLnRocm93RXJyb3IoJ0VuZCBvZiBmaWxlJyk7XG4gIGNvbnN0IGtpbmQgPSB0b2tlbkxhLmxhKCkhLnR5cGUgPT09IEh0bWxUb2tlblR5cGVbJ1snXSA/IEh0bWxUb2tlblR5cGVbJ10nXSA6IEh0bWxUb2tlblR5cGVbJyknXTtcbiAgbGV0IG5hbWU6IHN0cmluZztcbiAgdG9rZW5MYS5hZHZhbmNlKCk7XG4gIGlmIChpc05nQXR0ck5hbWUodG9rZW5MYSkpXG4gICAgbmFtZSA9IG5nQXR0ck5hbWUodG9rZW5MYSk7XG4gIGVsc2VcbiAgICBuYW1lID0gYXR0ck5hbWUodG9rZW5MYSk7XG4gIGlmICh0b2tlbkxhLmxhKCkhLnR5cGUgIT09IGtpbmQpXG4gICAgdG9rZW5MYS50aHJvd0Vycm9yKHRva2VuTGEubGEoKSEudGV4dCk7XG4gIHRva2VuTGEuYWR2YW5jZSgpO1xuICByZXR1cm4gbmFtZTtcbn1cbmZ1bmN0aW9uIGF0dHJOYW1lKHRva2VuTGE6IExvb2tBaGVhZDxUb2tlbjxIdG1sVG9rZW5UeXBlPiwgc3RyaW5nPikge1xuICByZXR1cm4gdG9rZW5MYS5hZHZhbmNlKCkudGV4dDtcbn1cbmZ1bmN0aW9uIGF0dHJWYWx1ZSh0aGlzOiB2b2lkLCB0b2tlbkxhOiBMb29rQWhlYWQ8VG9rZW48SHRtbFRva2VuVHlwZT4sIHN0cmluZz4pOiBBdHRyaWJ1dGVWYWx1ZUFzdCB8IHVuZGVmaW5lZCB7XG4gIGlmICh0b2tlbkxhLmxhKCkgJiYgdG9rZW5MYS5sYSgpIS50eXBlID09PSBIdG1sVG9rZW5UeXBlWyc9J10pIHtcbiAgICAvLyBsZXQge3RleHQsIHN0YXJ0LCBlbmR9ID0gdGhpcy5hZHZhbmNlKDIpO1xuICAgIC8vIHJldHVybiB7dGV4dCwgc3RhcnQsIGVuZH07XG4gICAgdG9rZW5MYS5hZHZhbmNlKCk7XG4gICAgbGV0IHN0YXJ0ID0gdG9rZW5MYS5sYSgpICYmIHRva2VuTGEubGEoKSEucG9zO1xuICAgIGxldCBlbmQgPSBzdGFydCE7XG4gICAgaWYgKHRva2VuTGEubGEoKSAmJiB0b2tlbkxhLmxhKCkhLnR5cGUgPT09IEh0bWxUb2tlblR5cGUucW0pIHtcbiAgICAgIGNvbnN0IHF1b3RlTWFyayA9IHRva2VuTGEuYWR2YW5jZSgpIS50ZXh0O1xuICAgICAgc3RhcnQgPSB0b2tlbkxhLmxhKCkgJiYgdG9rZW5MYS5sYSgpIS5wb3M7XG4gICAgICB3aGlsZSAodG9rZW5MYS5sYSgpICYmIHRva2VuTGEubGEoKSEudGV4dCAhPT0gcXVvdGVNYXJrKSB7XG4gICAgICAgIHRva2VuTGEuYWR2YW5jZSgpO1xuICAgICAgfVxuICAgICAgaWYgKCF0b2tlbkxhLmlzTmV4dFdpdGgoW3F1b3RlTWFya10sICh0b2tlbiwgdGV4dCkgPT4gdG9rZW4udGV4dCA9PT0gdGV4dCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdCAnICsgdG9rZW5MYS5sYSgpKTtcbiAgICAgIH1cbiAgICAgIGVuZCA9IHRva2VuTGEuYWR2YW5jZSgpLnBvcztcbiAgICAgIC8vIGNvbnNvbGUubG9nKCd2YWx1ZTonLCB0aGlzLnRleHQuc2xpY2Uoc3RhcnQsIGVuZCkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhcnQ6IHN0YXJ0ISxcbiAgICAgICAgZW5kLFxuICAgICAgICB0ZXh0OiAnKC0sLSknXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZW5kID0gc3RhcnQhO1xuICAgICAgd2hpbGUgKHRva2VuTGEubGEoKSAmJiAhdG9rZW5MYS5pc05leHRXaXRoKFtIdG1sVG9rZW5UeXBlLnNwYWNlXSwgaXNTYW1lVHlwZSkgJiZcbiAgICAgICAgIXRva2VuTGEuaXNOZXh0V2l0aChbSHRtbFRva2VuVHlwZVsnPiddXSwgaXNTYW1lVHlwZSkpIHtcbiAgICAgICAgICBlbmQgPSB0b2tlbkxhLmFkdmFuY2UoKS5lbmQ7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW5MYS5sYSgpID09IG51bGwpIHtcbiAgICAgICAgdG9rZW5MYS50aHJvd0Vycm9yKCdlbmQgb2YgZmlsZScpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhcnQ6IHN0YXJ0ISxcbiAgICAgICAgZW5kLFxuICAgICAgICB0ZXh0OiAnKC0sLSknXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm47XG4gIH1cbn1cblxuY29uc3QgcGFyc2VGdW5jID0gY3JlYXRlU3RyaW5nUGFyc2VyPEh0bWxUb2tlblR5cGUsIFBhcnNlSHRtbFJlc3VsdD4oJ0RyY3BIdG1sUGFyc2VyJywgbGV4ZXIsIGdyYW1tYXIpO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwYXJzZUh0bWwoaW5wdXQ6IHN0cmluZykge1xuICBjb25zdCByZXN1bHQgPSBwYXJzZUZ1bmMoaW5wdXQpO1xuICBmb3IgKGNvbnN0IHRhZyBvZiByZXN1bHQudGFncykge1xuICAgIGlmICh0YWcuYXR0cnMpIHtcbiAgICAgIGZvciAoY29uc3QgYXR0ck5hbWUgaW4gdGFnLmF0dHJzKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGFnLmF0dHJzLCBhdHRyTmFtZSkpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRhZy5hdHRyc1thdHRyTmFtZV07XG4gICAgICAgICAgaWYgKHZhbHVlLnZhbHVlKSB7XG4gICAgICAgICAgICBjb25zdCB7c3RhcnQsIGVuZH0gPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlLnRleHQgPSBpbnB1dC5zbGljZShzdGFydCwgZW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbiJdfQ==
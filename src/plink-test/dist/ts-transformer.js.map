{"version":3,"file":"ts-transformer.js","sourceRoot":"","sources":["ts-transformer.ts"],"names":[],"mappings":";;;AACA,iEAAkF;AAClF,uDAAqG;AACrG,sCAAoC;AACpC,0DAA0D;AAC1D,oEAA4B;AAC5B,2CAA2C;AAE3C,MAAM,sBAAsB,GAAG,IAAA,yCAA8B,EAAC,oBAAE,EAAE,EAAC,OAAO,EAAE;QAC1E,eAAe,EAAE,IAAI;QACrB,qBAAqB,CAAC,EAAE;YACtB,IAAA,yCAAgC,EAAC,EAA6B,EAAE,gBAAQ,CAAC,OAAO,EAAE,EAAE,EAAE,oBAAE,CAAC,CAAC;QAC5F,CAAC;KACF,EAAC,CAAC,CAAC;AAEJ,MAAM,iBAAiB,GAA0F,CAAC,OAAO,EAAE,EAAE;IAC3H,MAAM,WAAW,GAA6C;QAC5D,OAAO,CAAC,UAAU,EAAE,UAAU,EAAE,QAAQ;YACtC,MAAM,IAAI,GAAG,sBAAsB,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;YAC5D,sCAAsC;YACtC,OAAO,CAAC,GAAG,CAAC,4BAA4B,EAAE,UAAU,CAAC,CAAC;YACtD,OAAO,IAAI,CAAC;QACd,CAAC;KACF,CAAC;IAEF,OAAO,WAAW,CAAC;AACrB,CAAC,CAAC;AAEF,kBAAe,EAAC,iBAAiB,EAAC,CAAC","sourcesContent":["import {TransformerCreator, SyncTransformer} from '@jest/transform';\nimport {createTranspileFileWithTsCheck} from '@wfh/plink/wfh/dist/utils/tsc-util';\nimport {setupCompilerOptionsWithPackages, RequiredCompilerOptions} from '@wfh/plink/wfh/dist/ts-cmd';\nimport {plinkEnv} from '@wfh/plink';\n// import logConfig from '@wfh/plink/wfh/dist/log-config';\nimport ts from 'typescript';\n// inspector.open(9222, 'localhost', true);\n\nconst transformerWithTsCheck = createTranspileFileWithTsCheck(ts, {tscOpts: {\n  inlineSourceMap: true,\n  changeCompilerOptions(co) {\n    setupCompilerOptionsWithPackages(co as RequiredCompilerOptions, plinkEnv.workDir, {}, ts);\n  }\n}});\n\nconst createTransformer: TransformerCreator<SyncTransformer<Record<string, unknown>>, Record<string, unknown>> = (_config) => {\n  const transformer: SyncTransformer<Record<string, unknown>> = {\n    process(sourceText, sourcePath, _options) {\n      const done = transformerWithTsCheck(sourceText, sourcePath);\n      // eslint-disable-next-line no-console\n      console.log('[ts-transformer] transpile', sourcePath);\n      return done;\n    }\n  };\n\n  return transformer;\n};\n\nexport default {createTransformer};\n"]}